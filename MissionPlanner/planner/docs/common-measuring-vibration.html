

<!-- Path to wiki directories, without backslash -->

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Measuring Vibration &mdash; Mission Planner  documentation</title>
  

  <!-- favicon -->
  
  
    <link rel="shortcut icon" href="../_static/favicon_default.ico"/>
  
  <!-- favicon end -->
  
  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Mission Planner  documentation" href="../index.html"/>
        <link rel="up" title="Logs" href="common-logs.html"/>
        <link rel="next" title="Measuring Vibration with IMU Batch Sampler" href="common-imu-batchsampling.html"/>
        <link rel="prev" title="Downloading and Analyzing Data Logs in Mission Planner" href="common-downloading-and-analyzing-data-logs-in-mission-planner.html"/>  
  <script type="text/javascript">
  window.liveSettings = {
    api_key: "53747d3f35bf4cec9372629094cd9fe2",
    picker: "bottom-right",
    detectlang: true,
    autocollect: true,
    dynamic: false
  };
  </script>


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>



<body class="wy-body-for-nav" role="document">

        
    <div id='cssmenu'>
        <ul>
           <li><a href='/ardupilot/index.html'>Home</a>
              <ul>
                 <li><a href='/copter/index.html'>Copter</a></li>
                 <li><a href='/plane/index.html'>Plane</a></li>
                 <li><a href='/rover/index.html'>Rover</a></li>
                 <li><a href='http://ardusub.com/'>Sub</a></li>
                 <li><a href='/antennatracker/index.html'>AntennaTracker</a></li>
                 <li><a href='/planner/index.html'>Mission Planner</a></li>
                 <li><a href='/planner2/index.html'>APM Planner 2</a></li>
                 <li><a href='/mavproxy/index.html'>MAVProxy</a></li>
                 <li><a href='/dev/docs/companion-computers.html'>Companion Computers</a></li>
                 <li><a href='/dev/index.html'>Developer</a></li>
              </ul>
           </li>
           
          
           
           <li><a href='https://firmware.ardupilot.org/'>Downloads</a>
              <ul>
                <li><a href='https://firmware.ardupilot.org/Tools/MissionPlanner/'>Mission Planner</a></li>
                <li><a href='https://firmware.ardupilot.org/Tools/APMPlanner/'>APM Planner 2</a></li>
                   <li><a title="Advanced User Tools" href="common-downloads_advanced_user_tools.html">Advanced User Tools</a></li>
                   <li><a title="Developer Tools" href="common-downloads_developer_tools.html">Developer Tools</a></li>
                   <li><a title="Firmware" href="common-downloads_firmware.html">Firmware</a></li>
                </ul>
           </li>
           
           <li><a href='https://discuss.ardupilot.org' />Community</a>
              <ul>
                 <li><a href='https://discuss.ardupilot.org/'>Support Forums</a></li>
                 <li><a href='https://www.facebook.com/groups/ArduPilot.org'>Facebook</a></li>
                 <li><a href='https://ardupilot.org/discord'>Developer Chat (Discord)</a></li>
                 <li><a href='https://ardupilot.org/discord'>Developer Voice (Discord)</a></li>
				 <li><a href='https://ardupilot.org/dev/docs/common-contact-us.html'>Contact us</a></li>
				 <li><a href='https://ardupilot.org/dev/index.html#getting-involved'>Getting involved</a></li>
                   <li><a title="Commercial Support" href="common-commercial-support.html">Commercial Support</a></li>
                   <li><a title="Dev Team" href="common-team.html">Development Team</a></li>
              </ul>
           </li>
             <li><a title="Stores" href="common-stores.html">Stores</a></li>


             <li><a title="SWAG Shop" href="https://shop.ardupilot.org">SWAG</a></li>

           
           
                        <li><a title="About" href="../index.html">About</a>
               <ul>
                   <li><a title="History of ArduPilot" href="common-history-of-ardupilot.html">History</a></li>
                   <li><a href='https://ardupilot.org/dev/docs/license-gplv3.html'>License</a></li>
                   <li><a href='https://ardupilot.org/dev/docs/trademark.html'>Trademark</a></li>
                   <li><a title="Acknowledgments" href="common-acknowledgments.html">Acknowledgments</a></li>
                   <li><a title="Wiki Editing Guide" href="common-wiki_editing_guide.html">Wiki Editing Guide</a></li>
               </ul>
             </li>
        </ul>
        
<style>
#jdlogo {
  top: 10px;
  right: 20px;
  position: absolute;
  color: #dddddd;
}
#jdlogo a:visited,
#jdlogo a:link {
  color: #9B59B6;
}
#jdlogo a:hover,
#jdlogo a:active {
  color: #CACACA;
}
</style>

</div>

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> Mission Planner
        

        
          
          <img src="../_static/ardupilot_logo.png" class="logo" />
        
        </a>

        
          
          
        

        
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        
        
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="mission-planner-overview.html">Mission Planner Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="mission-planner-installation.html">Installing Mission Planner (Windows)</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-loading-firmware-onto-pixhawk.html">Loading Firmware onto boards with existing ArduPilot firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-loading-firmware-onto-chibios-only-boards.html">Loading Firmware onto boards without existing ArduPilot firmware (first time only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-connect-mission-planner-autopilot.html">Connect Mission Planner to AutoPilot</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">Mission Planning</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="mission-planner-features.html">Mission Planner Features/Screens</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mission-planner-ground-control-station.html">Flight DATA Screen Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mission-planner-flight-plan.html">Flight PLAN Screen</a></li>
<li class="toctree-l2"><a class="reference internal" href="mission-planner-initial-setup.html">SETUP Screen</a></li>
<li class="toctree-l2"><a class="reference internal" href="mission-planner-configuration-and-tuning.html">CONFIGuration and Tuning Screens</a></li>
<li class="toctree-l2"><a class="reference internal" href="mission-planner-simulation.html">SIMULATION Screen</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="common-logs.html">Logs</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="common-logs.html#topics-related-to-logging-and-analysis">Topics related to logging and analysis</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="common-diagnosing-problems-using-logs.html">Diagnosing problems using Logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-downloading-and-analyzing-data-logs-in-mission-planner.html">Dataflash Logs</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Measuring Vibration</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-imu-batchsampling.html">Measuring Vibration with &quot;Batch Sampling&quot;</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-mission-planner-telemetry-logs.html">Telemetry Logs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="common-logs.html#tools-for-log-analysis">Tools for log analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="other-mission-planner-features.html">Advanced Mission Planner Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="mission-planner-language-translations.html">Language Translations</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-compass-calibration-in-mission-planner.html">Compass Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-accelerometer-calibration.html">Accelerometer Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-radio-control-calibration.html">Radio Control Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-rc-transmitter-flight-mode-configuration.html">RC Transmitter Flight Mode Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mission-planner-building.html">Mission Planner Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-appendix.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-table-of-contents.html">Table of Contents</a></li>
</ul>

          
        
        
        <!-- add paypal and dronecode logos -->
                <div style="margin: auto; padding-left:20px; padding-right:20px; width=100%">

        <hr />
        <form style="margin:auto;" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
        <input type="hidden" name="cmd" value="_s-xclick" />
        <input type="hidden" name="hosted_button_id" value="BBF28AFAD58B2" />
        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate" />
        </form>
        <br>
        <a href="common-donation.html">Individual</a>
        <a href="common-partners.html">Partners</a>
        <a href="https://shop.ardupilot.org">SWAG Shop</a>

        <hr />
        </div>
        <!-- endadd paypal and dronecode logos -->
              
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Mission Planner</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



 
 
 
 
 
  
   
 

<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="mission-planner-features.html">Mission Planner Features/Screens</a> &raquo;</li>
      
          <li><a href="common-logs.html">Logs</a> &raquo;</li>
      
    <li>Measuring Vibration</li>
      <li class="wy-breadcrumbs-aside">
                
          
            <a href="https://github.com/ArduPilot/ardupilot_wiki/blob/master/common/source/docs/common-measuring-vibration.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="measuring-vibration">
<span id="common-measuring-vibration"></span><h1>Measuring Vibration<a class="headerlink" href="#measuring-vibration" title="Permalink to this headline">¶</a></h1>
<p>Autopilots have accelerometers that are sensitive to vibrations.
These accelerometer values are combined with barometer and
GPS data to estimate the vehicle’s position. With excessive
vibrations, the estimate can be thrown off and lead to very bad
performance in modes that rely on accurate positioning (e.g. on Copter:
AltHold, Loiter, RTL, Guided, Position and Auto flight modes).</p>
<p>These instructions explain how to measure the vibration levels. If you
find they are out-of-tolerance then follow the advice found on the <a class="reference external" href="https://ardupilot.org/rover/docs/common-vibration-damping.html#common-vibration-damping" title="(in Rover)"><span class="xref std std-ref">Vibration Damping</span></a> page.</p>
<div class="section" id="real-time-view-in-ground-station">
<h2>Real-Time view in Ground Station<a class="headerlink" href="#real-time-view-in-ground-station" title="Permalink to this headline">¶</a></h2>
<p>Ground Stations can display a real-time view of vibration and clipping.  If using the Mission Planner click on “Vibe” on the HUD to display the current vibration levels.</p>
<blockquote>
<div><a class="reference external image-reference" href="../_images/vibration-realtime-mp.png"><img alt="../_images/vibration-realtime-mp.png" src="../_images/vibration-realtime-mp.png" style="width: 450px;" /></a>
</div></blockquote>
<p>Vibration levels below 30m/s/s are normally acceptable.  Levels above 30m/s/s <em>may</em> have problems and levels above 60m/s/s nearly always have problems with position or altitude hold.</p>
</div>
<div class="section" id="vibe-dataflash-log-message">
<h2>Vibe Dataflash Log message<a class="headerlink" href="#vibe-dataflash-log-message" title="Permalink to this headline">¶</a></h2>
<p>Check the recorded Vibe levels are mostly below 30m/s/s</p>
<ul>
<li><p class="first">Perform a regular flight (i.e. not just a gentle hover) of at least a
few minutes and <a class="reference internal" href="common-downloading-and-analyzing-data-logs-in-mission-planner.html#common-downloading-and-analyzing-data-logs-in-mission-planner-downloading-logs-via-mavlink"><span class="std std-ref">download the dataflash logs</span></a>.</p>
</li>
<li><p class="first">Using the Mission Planner or other ground station graph the VIBE message’s
VibeX, VibeY and VibeZ values.  These show the standard deviation of
the primary accelerometer’s output in m/s/s.  The image below, taken
from a 3DR IRIS, shows normal levels which are below 15m/s/s but
occasionally peak to 30m/s/s.  Maximum acceptable values appear to be
below 30m/s/s (see second picture below).</p>
</li>
<li><p class="first">Graph the Clip0, Clip1 and Clip2 values which increase each time one
of the accelerometers reaches its maximum limit (16G).  Ideally
these should be zero for the whole flight but low numbers (&lt;100) are
likely ok especially if they occur during hard landings.  A regularly
increasing number through the log indicates a serious vibration
problem that <a class="reference external" href="https://ardupilot.org/rover/docs/common-vibration-damping.html#common-vibration-damping" title="(in Rover)"><span class="xref std std-ref">should be fixed</span></a>.</p>
<a class="reference external image-reference" href="../_images/mp_vibe_dataflash_msg.png"><img alt="../_images/mp_vibe_dataflash_msg.png" src="../_images/mp_vibe_dataflash_msg.png" style="width: 450px;" /></a>
</li>
</ul>
<p>This is an example of a vehicle that had position estimate problems due
to high vibrations.</p>
<a class="reference external image-reference" href="../_images/mp_measuring_vibration_bad_vibes.png"><img alt="../_images/mp_measuring_vibration_bad_vibes.png" src="../_images/mp_measuring_vibration_bad_vibes.png" style="width: 450px;" /></a>
<p>The algorithm for calculating the vibration levels can be seen in the
<a class="reference external" href="https://github.com/ArduPilot/ardupilot/blob/master/libraries/AP_InertialSensor/AP_InertialSensor.cpp#L1609">AP_InertialSensor.cpp’s calc_vibration_and_clipping()</a>
method but in short it involves calculating the standard deviation of
the accelerometer readings like this:</p>
<ul class="simple">
<li>Capture the raw x, y and z accelerometer values from the primary IMU</li>
<li>High-pass filter the raw values at 5hz to remove the vehicle’s
movement and create a “accel_vibe_floor” for x,y and z axis.</li>
<li>Calculate the difference between the latest accel values and the
accel_vibe_floor.</li>
<li>Square the above differences, filter at 2hz and then calculate the
square root (for x, y and z).  These final three values are what
appear in the VIBE msg’s VibeX, Y and Z fields.</li>
</ul>
</div>
<div class="section" id="looking-for-the-leans">
<h2>Looking for “The Leans”<a class="headerlink" href="#looking-for-the-leans" title="Permalink to this headline">¶</a></h2>
<p><strong>The Leans</strong> occurs when the vehicle’s attitude estimate becomes incorrect causing it to lean significantly even though the pilot is commanding level flight.  The cause of the problem is often accelerometer aliasing which can be confirmed by comparing the Roll and Pitch attitude estimates from each of the estimation systems (i.e. each AHRSs or EKFs).  The attitude estimates should be within a few degrees of each other</p>
<ul class="simple">
<li>Download the dataflash log and open in the ground station’s log viewer</li>
<li>Compare the AHRS2.Roll, NKF1[0].Roll and NKF1[1].Roll</li>
</ul>
<p>The image below shows a typical log in which the attitudes match well</p>
<a class="reference external image-reference" href="../_images/vibration-measuring-leans.png"><img alt="../_images/vibration-measuring-leans.png" src="../_images/vibration-measuring-leans.png" style="width: 450px;" /></a>
</div>
<div class="section" id="advanced-analysis-with-fft">
<h2>Advanced Analysis with FFT<a class="headerlink" href="#advanced-analysis-with-fft" title="Permalink to this headline">¶</a></h2>
<p>Refer to the <a class="reference internal" href="common-imu-batchsampling.html#common-imu-batchsampling"><span class="std std-ref">Measuring Vibration with IMU Batch Sampler</span></a> page for instructions on how to collect large amounts of IMU data and perform an FFT analysis to determine the frequencies with the most vibration.</p>
</div>
<div class="section" id="imu-dataflash-log-message">
<h2>IMU Dataflash Log message<a class="headerlink" href="#imu-dataflash-log-message" title="Permalink to this headline">¶</a></h2>
<p>For very old versions of ArduPilot that do not include the Vibe message the IMU values can be checked directly</p>
<ul>
<li><p class="first">Ensure the <a class="reference external" href="https://ardupilot.org/rover/docs/parameters.html#log-bitmask" title="(in Rover)"><span class="xref std std-ref">LOG_BITMASK</span></a> parameter is set to include IMU data so accelerometer values are recorded to the dataflash logs</p>
</li>
<li><p class="first">Fly your copter in Stabilize mode and try to maintain a level hover (it doesn’t need to be perfectly stable or level)</p>
</li>
<li><p class="first"><a class="reference internal" href="common-downloading-and-analyzing-data-logs-in-mission-planner.html#common-downloading-and-analyzing-data-logs-in-mission-planner-downloading-logs-via-mavlink"><span class="std std-ref">Download the dataflash logs and</span></a>
after the download has completed, use the Mission Planner’s “Review a
Log” button to open the latest file in the log directory (it’s last
digit will be the Log number you downloaded so in the example above
we downloaded Log #1 so the filename will end in 1.log)</p>
</li>
<li><p class="first">When the Log Browser appears, scroll down until you find any IMU
message.  Click on the row’s AccX and push <strong>Graph this data</strong> Left
button.  Repeat for the AccY and AccZ columns to produce a graph like
below.</p>
<p><a class="reference external" href="../_images/DiagnosingWithLogs_Vibes.png"><img alt="DiagnosingWithLogs_Vibes" src="../_images/DiagnosingWithLogs_Vibes.png" /></a></p>
</li>
<li><p class="first">Check the scale on the left and ensure that your vibration levels for
the AccX and AccY are between -3 and +3.  For AccZ the acceptable
range is -15 to -5.  If it is very close or over these limits you
should refer back to the <a class="reference external" href="https://ardupilot.org/rover/docs/common-vibration-damping.html#common-vibration-damping" title="(in Rover)"><span class="xref std std-ref">Vibration Damping</span></a> page for possible solutions.</p>
</li>
<li><p class="first">After all the above is complete, go to the Mission Planner’s standard
parameters page (you may need to press the <strong>Connect</strong> button again)
and set the Log Bitmask back to “Default”.  This is important because
especially on the APM logging requires significant CPU resources and
it’s a waste to log these if they’re not really needed.</p>
</li>
</ul>
</div>
</div>


            
            
             
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="common-imu-batchsampling.html" class="btn btn-neutral float-right" title="Measuring Vibration with IMU Batch Sampler" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="common-downloading-and-analyzing-data-logs-in-mission-planner.html" class="btn btn-neutral" title="Downloading and Analyzing Data Logs in Mission Planner" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  
  
  Questions, issues, and suggestions about this page can be raised on the <a href="https://discuss.ardupilot.org">forums</a>. Issues and suggestions may be posted on the forums or the <a href="https://github.com/ArduPilot/ardupilot_wiki/issues/new?title=Measuring Vibration&amp;body=[Measuring Vibration](https://ardupilot.org/planner/docs/common-measuring-vibration.html)%20-%20Describe%20the%20issue/suggestion%20and%20improve%20the%20title.%20Please%20keep%20a%20link%20to%20the%20original%20article%20if%20relevant.&amp;labels=docs">Github Issue Tracker</a>.
  <hr/>

  <div role="contentinfo">
    <p>
    <a style="float:right;" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a>
        &copy; Copyright 2020, ArduPilot Dev Team.

    </p>
  </div>
  


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
    <script type="text/javascript" src="../_static/js/menubar.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   


<!-- Google Analytics -->
<!-- This is official ArduPilot analytics account -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  _gaq.push(['_trackPageLoadTime']);
  _gaq.push(["_setSiteSpeedSampleRate", 0]);
  ga('create', 'UA-75650032-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- Google Analytics -->

</body>
</html>