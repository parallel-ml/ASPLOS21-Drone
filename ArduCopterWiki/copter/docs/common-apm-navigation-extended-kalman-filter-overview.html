

<!-- Path to wiki directories, without backslash -->

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extended Kalman Filter (EKF) &mdash; Copter  documentation</title>
  

  <!-- favicon -->
  
  
    <link rel="shortcut icon" href="../_static/favicon_copter.ico"/>
  
  <!-- favicon end -->
  
  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Copter  documentation" href="../index.html"/>
        <link rel="up" title="Advanced Configuration" href="common-advanced-configuration.html"/>
        <link rel="next" title="Fences" href="common-geofencing-landing-page.html"/>
        <link rel="prev" title="BLHeli_32 ESC Telemetry" href="common-dshot-blheli32-telemetry.html"/>  
  <script type="text/javascript">
  window.liveSettings = {
    api_key: "53747d3f35bf4cec9372629094cd9fe2",
    picker: "bottom-right",
    detectlang: true,
    autocollect: true,
    dynamic: false
  };
  </script>


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>



<body class="wy-body-for-nav" role="document">

        
    <div id='cssmenu'>
        <ul>
           <li><a href='/ardupilot/index.html'>Home</a>
              <ul>
                 <li><a href='/copter/index.html'>Copter</a></li>
                 <li><a href='/plane/index.html'>Plane</a></li>
                 <li><a href='/rover/index.html'>Rover</a></li>
                 <li><a href='http://ardusub.com/'>Sub</a></li>
                 <li><a href='/antennatracker/index.html'>AntennaTracker</a></li>
                 <li><a href='/planner/index.html'>Mission Planner</a></li>
                 <li><a href='/planner2/index.html'>APM Planner 2</a></li>
                 <li><a href='/mavproxy/index.html'>MAVProxy</a></li>
                 <li><a href='/dev/docs/companion-computers.html'>Companion Computers</a></li>
                 <li><a href='/dev/index.html'>Developer</a></li>
              </ul>
           </li>
           
          
           
           <li><a href='https://firmware.ardupilot.org/'>Downloads</a>
              <ul>
                <li><a href='https://firmware.ardupilot.org/Tools/MissionPlanner/'>Mission Planner</a></li>
                <li><a href='https://firmware.ardupilot.org/Tools/APMPlanner/'>APM Planner 2</a></li>
                   <li><a title="Advanced User Tools" href="common-downloads_advanced_user_tools.html">Advanced User Tools</a></li>
                   <li><a title="Developer Tools" href="common-downloads_developer_tools.html">Developer Tools</a></li>
                   <li><a title="Firmware" href="common-downloads_firmware.html">Firmware</a></li>
                </ul>
           </li>
           
           <li><a href='https://discuss.ardupilot.org' />Community</a>
              <ul>
                 <li><a href='https://discuss.ardupilot.org/'>Support Forums</a></li>
                 <li><a href='https://www.facebook.com/groups/ArduPilot.org'>Facebook</a></li>
                 <li><a href='https://ardupilot.org/discord'>Developer Chat (Discord)</a></li>
                 <li><a href='https://ardupilot.org/discord'>Developer Voice (Discord)</a></li>
				 <li><a href='https://ardupilot.org/dev/docs/common-contact-us.html'>Contact us</a></li>
				 <li><a href='https://ardupilot.org/dev/index.html#getting-involved'>Getting involved</a></li>
                   <li><a title="Commercial Support" href="common-commercial-support.html">Commercial Support</a></li>
                   <li><a title="Dev Team" href="common-team.html">Development Team</a></li>
                   <li><a title="Training Centers" href="common-training-centers.html">UAS Training Centers</a></li>
              </ul>
           </li>
             <li><a title="Stores" href="common-stores.html">Stores</a></li>


             <li><a title="SWAG Shop" href="https://shop.ardupilot.org">SWAG</a></li>

           
           
                        <li><a title="About" href="../index.html">About</a>
               <ul>
                   <li><a title="Project News" href="project-news.html">News</a></li>
                   <li><a title="History of ArduPilot" href="common-history-of-ardupilot.html">History</a></li>
                   <li><a href='https://ardupilot.org/dev/docs/license-gplv3.html'>License</a></li>
                   <li><a href='https://ardupilot.org/dev/docs/trademark.html'>Trademark</a></li>
                   <li><a title="Acknowledgments" href="common-acknowledgments.html">Acknowledgments</a></li>
                   <li><a title="Wiki Editing Guide" href="common-wiki_editing_guide.html">Wiki Editing Guide</a></li>
               </ul>
             </li>
        </ul>
        
<style>
#jdlogo {
  top: 10px;
  right: 20px;
  position: absolute;
  color: #dddddd;
}
#jdlogo a:visited,
#jdlogo a:link {
  color: #9B59B6;
}
#jdlogo a:hover,
#jdlogo a:active {
  color: #CACACA;
}
</style>

</div>

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> Copter
        

        
          
          <img src="../_static/ardupilot_logo.png" class="logo" />
        
        </a>

        
          
          
        

        
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        
        
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introducing Copter</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-autopilots.html">AutoPilot Hardware Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial-setup.html">First Time Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="flying-arducopter.html">First Flight</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-when-problems-arise.html">If A Problem Arises</a></li>
<li class="toctree-l1"><a class="reference internal" href="copter-flight-features.html">Flight Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="common-advanced-configuration.html">Advanced Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="common-rcoutput-mapping.html">Autopilot Output Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="autotune.html">AutoTune</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-auxiliary-functions.html">Auxiliary Function Switches</a></li>
<li class="toctree-l2"><a class="reference internal" href="channel-7-and-8-options.html">Auxiliary Function Switches (3.6 and earlier)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-baro-temp-comp.html">Baro Temperature Compensation</a></li>
<li class="toctree-l2"><a class="reference internal" href="boat-mode.html">Boat mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-bootloader-update.html">Bootloader Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-canbus-setup-advanced.html">CAN Bus Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-compass-setup-advanced.html">Compass Setup (Advanced)</a></li>
<li class="toctree-l2"><a class="reference internal" href="current-limiting-and-voltage-scaling.html">Current Limiting and Voltage Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-dshot.html">Brushless ESCs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Extended Kalman Filter (EKF)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#should-the-ekf2-or-ekf3-be-used">Should the EKF2 or EKF3 be used?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choosing-the-ekf-and-number-of-cores">Choosing the EKF and number of cores</a></li>
<li class="toctree-l3"><a class="reference internal" href="#affinity-and-lane-switching">Affinity and Lane Switching</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gps-non-gps-transitions">GPS / Non-GPS Transitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#commonly-modified-parameters">Commonly modified parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="common-geofencing-landing-page.html">Fence Failsafes</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-flight-time-recorder.html">Flight Time Recorder</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-FPort-receivers.html">FPort Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-gpios.html">GPIOs</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-gps-for-yaw.html">GPS for Yaw (aka Moving Baseline)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-gcs-only-operation.html">Ground Control Station Only Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ground-effect-compensation.html">Ground Effect Compensation</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-imu-fft.html">In-Flight FFT Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-watchdog.html">Independent Watchdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-lua-scripts.html">LUA Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-magnetic-interference.html">Magnetic Interference</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-MAVLink2-signing.html">MAVLink2 Packet Signing (Security)</a></li>
<li class="toctree-l2"><a class="reference internal" href="motor-thrust-scaling.html">Motor Thrust Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-non-gps-navigation-landing-page.html">Non-GPS Navigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-ntf-devices.html">Notification Devices (LEDs,Buzzer,etc.)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-imu-notch-filtering.html">Notch Filter Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-object-avoidance-landing-page.html">Object Avoidance</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-optical-flow-sensor-setup.html">Optical Flow Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Parameter List (Full)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-parameter-reset.html">Parameter Reset</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-rcmap.html">RC Input Channel Mapping (RCMAP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-rc-options.html">RC Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-camera-runcam.html">RunCam Camera Configuration and Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-sensor-offset-compensation.html">Sensor Position Offset Compensation</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-sensor-testing.html">Sensor Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-serial-passthrough.html">Serial Port to Port Passthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-serial-options.html">Serial Port Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="terrain-following-manual-modes.html">Surface Tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-telemetry-port-setup.html">Telemetry Port Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="terrain-following.html">Terrain Following (Autonomous modes)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-tuning.html">Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-uavcan-setup-advanced.html">UAVCAN Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-ublox-gps.html">UBlox GPS Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">Mission Planning</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-logs.html">Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-optional-hardware.html">Peripheral Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="traditional-helicopters.html">Traditional Helicopters</a></li>
<li class="toctree-l1"><a class="reference internal" href="tricopter.html">Tricopter</a></li>
<li class="toctree-l1"><a class="reference internal" href="singlecopter-and-coaxcopter.html">SingleCopter and CoaxCopter</a></li>
<li class="toctree-l1"><a class="reference internal" href="heliquads.html">HeliQuads</a></li>
<li class="toctree-l1"><a class="reference internal" href="skyrocket.html">SkyRocket</a></li>
<li class="toctree-l1"><a class="reference internal" href="solo_arducopter_upgrade.html">Solo</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference-frames.html">Reference Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-use-cases-and-applications.html">Use-Cases and Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-antenna-tracking.html">Antenna Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-simulation.html">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-master-features.html">Upcoming Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-user-alerts.html">User Alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-appendix.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-table-of-contents.html">Full Table of Contents</a></li>
</ul>

          
        
        
        <!-- add paypal and dronecode logos -->
                <div style="margin: auto; padding-left:20px; padding-right:20px; width=100%">

        <hr />
        <form style="margin:auto;" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
        <input type="hidden" name="cmd" value="_s-xclick" />
        <input type="hidden" name="hosted_button_id" value="BBF28AFAD58B2" />
        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate" />
        </form>
        <br>
        <a href="common-donation.html">Individual</a>
        <a href="common-partners.html">Partners</a>
        <a href="https://shop.ardupilot.org">SWAG Shop</a>

        <hr />
        </div>
        <!-- endadd paypal and dronecode logos -->
              
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Copter</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



 
 
 
 
 
  
   
 

<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="common-advanced-configuration.html">Advanced Configuration</a> &raquo;</li>
      
    <li>Extended Kalman Filter (EKF)</li>
      <li class="wy-breadcrumbs-aside">
                
          
            <a href="https://github.com/ArduPilot/ardupilot_wiki/blob/master/common/source/docs/common-apm-navigation-extended-kalman-filter-overview.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extended-kalman-filter-ekf">
<span id="common-apm-navigation-extended-kalman-filter-overview"></span><h1>Extended Kalman Filter (EKF)<a class="headerlink" href="#extended-kalman-filter-ekf" title="Permalink to this headline">¶</a></h1>
<img alt="../_images/advanced-configuration-ekf.png" src="../_images/advanced-configuration-ekf.png" />
<p>Copter and Plane can use an Extended Kalman Filter (EKF) algorithm to
estimate vehicle position, velocity and angular orientation based on
rate gyroscopes, accelerometer, compass, GPS, airspeed and barometric
pressure measurements.</p>
<p>The advantage of the EKF over the simpler complementary filter
algorithms (i.e. “Inertial Nav”), is that by fusing all available measurements it is better
able to reject measurements with significant errors. This makes the
vehicle less susceptible to faults that affect a single sensor. EKF also
enables measurements from optional sensors such as optical flow and
laser range finders to be used to assist navigation.</p>
<p>Current stable version of ArduPilot use the EKF2 as their primary attitude and position estimation source with DCM running quietly in the background.
If the autopilot has two (or more) IMUs available, two EKF “cores” (i.e. two instances of the EKF) will run in parallel, each using a different IMU.
At any one time, only the output from a single EKF core is ever used, that core being the one that reports the best health which is determined by the consistency of its sensor data.</p>
<p>Most user should not need to modify any EKF parameters but the information below provides some information on those parameters that are most commonly changed.
More detailed information can be found on the <a class="reference external" href="https://ardupilot.org/dev/docs/extended-kalman-filter.html#extended-kalman-filter" title="(in Dev)"><span class="xref std std-ref">developer EKF wiki page</span></a>.</p>
<div class="section" id="should-the-ekf2-or-ekf3-be-used">
<h2>Should the EKF2 or EKF3 be used?<a class="headerlink" href="#should-the-ekf2-or-ekf3-be-used" title="Permalink to this headline">¶</a></h2>
<p>In general we recommend users stick with the EKF2 but there are some cases where the EKF3 should be used.  Below is a list of advantages of each:</p>
<ul class="simple">
<li>EKF2 is used by default for most users, has had the most testing and is considered the most stable</li>
<li>EKF2 can accept external position estimates from Vicon systems or ROS SLAM (HectorSLAM, Cartographer, etc).  EKF3 will get this feature once <a class="reference external" href="https://github.com/ArduPilot/ardupilot/pull/8730">this PR</a> is merged</li>
<li>EKF3 should be used on tailsitters or any other vehicle that spends a significant amount of time pointing directly up or down.  The reason is that the EKF2 only estimates accelerometer Z-axis offsets while EKF3 estimates for all 3 axis</li>
<li>EKF3 accepts some newer sensor sources including Beacons, Wheel Encoders and Visual Odometry</li>
<li>EKF2 estimates gyro scale factors but the EKF3 does not.  In general this is not important because gyro scale factors are nearly always very close to 1.0.  This may be important for vehicles that spin very rapidly</li>
</ul>
</div>
<div class="section" id="choosing-the-ekf-and-number-of-cores">
<h2>Choosing the EKF and number of cores<a class="headerlink" href="#choosing-the-ekf-and-number-of-cores" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://ardupilot.org/dev/docs/extended-kalman-filter.html#extended-kalman-filter-ahrs-ekf-use" title="(in Dev)"><span class="xref std std-ref">AHRS_EKF_USE</span></a>: set to “1” to use the EKF, “0” to use DCM for attitude control and
inertial nav (Copter-3.2.1) or ahrs dead reckoning (Plane) for position control.  In Copter-3.3 (and higher) this parameter is forced to “1” and cannot be changed.</p>
<p><a class="reference internal" href="parameters.html#ahrs-ekf-type"><span class="std std-ref">AHRS_EKF_TYPE</span></a>: set to “2” to use EKF2 for attitude and position estimation, “3” for EKF3.</p>
<p><a class="reference internal" href="parameters.html#ek2-enable"><span class="std std-ref">EK2_ENABLE</span></a>, <a class="reference internal" href="parameters.html#ek3-enable"><span class="std std-ref">EK3_ENABLE</span></a>: set to “1” to enable the EKF2 and/or EKF3 respectively.</p>
<p><a class="reference internal" href="parameters.html#ek2-imu-mask"><span class="std std-ref">EK2_IMU_MASK</span></a>, <a class="reference internal" href="parameters.html#ek3-imu-mask"><span class="std std-ref">EK3_IMU_MASK</span></a>: a bitmask specifying which IMUs (i.e. accelerometer/gyro) to use.  An EKF “core” (i.e. a single EKF instance) will be started for each IMU specified.</p>
<ul class="simple">
<li>1: starts a single EKF core using the first IMU</li>
<li>2: starts a single EKF core using only the second IMU</li>
<li>3: starts two separate EKF cores using the first and second IMUs respectively</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Plane and Rover will fall back from EKF2 or EKF3 to DCM if the EKF becomes unhealthy or the EKF is not fusing GPS data despite the GPS having 3D Lock.
There is no fallback from EKF3 to EKF2 (or EKF2 to EKF1)</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Using the parameters above it is possible to run up to 5 AHRSs in parallel at the same time (DCMx1, EKF2x2, EKF3x2) but this can result in performance problems so if running EKF2 and EKF3 in parallel, set the IMU_MASK to reduce the total number of cores.</p>
</div>
</div>
<div class="section" id="affinity-and-lane-switching">
<h2>Affinity and Lane Switching<a class="headerlink" href="#affinity-and-lane-switching" title="Permalink to this headline">¶</a></h2>
<p>EKF3 provides the feature of sensor affinity which allows the EKF cores to also use non-primary instances of sensors, specifically, Airspeed, Barometer, Compass (Magnetometer) and GPS. This allows the vehicle to better manage good quality sensors and be able to switch lanes accordingly to use the best-performing one for state estimation. For more details and configuration, refer <a class="reference external" href="https://ardupilot.org/dev/docs/ek3-affinity-lane-switching.html#ek3-affinity-lane-switching" title="(in Dev)"><span class="xref std std-ref">EKF3 Affinity and Lane Switching</span></a>.</p>
</div>
<div class="section" id="gps-non-gps-transitions">
<h2>GPS / Non-GPS Transitions<a class="headerlink" href="#gps-non-gps-transitions" title="Permalink to this headline">¶</a></h2>
<p>EKF3 (in ArduPilot 4.1 and higher) supports in-flight switching of sensors which can be useful for transitioning between GPS and Non-GPS environments.  See <a class="reference internal" href="common-non-gps-to-gps.html#common-non-gps-to-gps"><span class="std std-ref">GPS / Non-GPS Transitions</span></a> for more details.</p>
</div>
<div class="section" id="commonly-modified-parameters">
<h2>Commonly modified parameters<a class="headerlink" href="#commonly-modified-parameters" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="parameters.html#ek2-alt-source"><span class="std std-ref">EK2_ALT_SOURCE</span></a> which sensor to use as the primary altitude source</p>
<ul class="simple">
<li>0 : use barometer (default)</li>
<li>1 : use range finder.  <strong>Do not use this option unless the vehicle is being flown indoors where the ground is flat</strong>.  For terrain following please see <a class="reference internal" href="terrain-following.html#terrain-following"><span class="std std-ref">copter</span></a> and <a class="reference external" href="https://ardupilot.org/plane/docs/common-terrain-following.html#common-terrain-following" title="(in Plane)"><span class="xref std std-ref">plane specific terrain following instructions</span></a> which do not require changing this parameter.</li>
<li>2 : use GPS.  Useful when GPS quality is very good and barometer drift could be a problem.  For example if the vehicle will perform long distance missions with altitude changes of &gt;100m.</li>
</ul>
<p><a class="reference external" href="https://ardupilot.org/dev/docs/extended-kalman-filter.html#extended-kalman-filter-ekf-alt-noise" title="(in Dev)"><span class="xref std std-ref">EK2_ALT_M_NSE</span></a>: Default is “1.0”.  Lower number reduces reliance on accelerometers, increases reliance on barometer.</p>
<p><a class="reference external" href="https://ardupilot.org/dev/docs/extended-kalman-filter.html#extended-kalman-filter-ekf-gps-type" title="(in Dev)"><span class="xref std std-ref">EK2_GPS_TYPE</span></a>:
Controls how GPS is used.</p>
<ul class="simple">
<li>0 : use 3D velocity &amp; 2D position from GPS</li>
<li>1 : use 2D velocity &amp; 2D position (GPS velocity does not contribute
to altitude estimate)</li>
<li>2: use 2D position</li>
<li>3 : no GPS (will use <a class="reference external" href="https://ardupilot.org/copter/docs/common-optical-flow-sensors-landingpage.html#common-optical-flow-sensors-landingpage" title="(in Copter)"><span class="xref std std-ref">optical flow</span></a> only if available)</li>
</ul>
<p><a class="reference internal" href="parameters.html#ek2-yaw-m-nse"><span class="std std-ref">EK2_YAW_M_NSE</span></a>: Controls the weighting between GPS and Compass when calculating the heading.  Default is “0.5”, lower values will cause the compass to be trusted more (i.e. higher weighting to the compass)</p>
<p>As mentioned above, a more detailed overview of EKF theory and tuning parameters is available on the developer wiki’s <a class="reference external" href="https://ardupilot.org/dev/docs/extended-kalman-filter.html#extended-kalman-filter" title="(in Dev)"><span class="xref std std-ref">Extended Kalman Filter Navigation Overview and Tuning</span></a>.</p>
</div>
</div>


            
            
             
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="common-geofencing-landing-page.html" class="btn btn-neutral float-right" title="Fences" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="common-dshot-blheli32-telemetry.html" class="btn btn-neutral" title="BLHeli_32 ESC Telemetry" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  
  
  Questions, issues, and suggestions about this page can be raised on the <a href="https://discuss.ardupilot.org">forums</a>. Issues and suggestions may be posted on the forums or the <a href="https://github.com/ArduPilot/ardupilot_wiki/issues/new?title=Extended Kalman Filter (EKF)&amp;body=[Extended Kalman Filter (EKF)](https://ardupilot.org/copter/docs/common-apm-navigation-extended-kalman-filter-overview.html)%20-%20Describe%20the%20issue/suggestion%20and%20improve%20the%20title.%20Please%20keep%20a%20link%20to%20the%20original%20article%20if%20relevant.&amp;labels=docs">Github Issue Tracker</a>.
  <hr/>

  <div role="contentinfo">
    <p>
    <a style="float:right;" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a>
        &copy; Copyright 2020, ArduPilot Dev Team.

    </p>
  </div>
  


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>
      <script type="text/javascript" src="../_static/./useralerts.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
    <script type="text/javascript" src="../_static/js/menubar.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   


<!-- Google Analytics -->
<!-- This is official ArduPilot analytics account -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  _gaq.push(['_trackPageLoadTime']);
  _gaq.push(["_setSiteSpeedSampleRate", 0]);
  ga('create', 'UA-75650032-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- Google Analytics -->

</body>
</html>