

<!-- Path to wiki directories, without backslash -->

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Lua Scripts &mdash; Copter  documentation</title>
  

  <!-- favicon -->
  
  
    <link rel="shortcut icon" href="../_static/favicon_copter.ico"/>
  
  <!-- favicon end -->
  
  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Copter  documentation" href="../index.html"/>
        <link rel="up" title="Advanced Configuration" href="common-advanced-configuration.html"/>
        <link rel="next" title="Decoding the LUA Binding Descriptions" href="common-lua-binding-syntax.html"/>
        <link rel="prev" title="Ground Effect Compensation" href="ground-effect-compensation.html"/>  
  <script type="text/javascript">
  window.liveSettings = {
    api_key: "53747d3f35bf4cec9372629094cd9fe2",
    picker: "bottom-right",
    detectlang: true,
    autocollect: true,
    dynamic: false
  };
  </script>


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>



<body class="wy-body-for-nav" role="document">

        
    <div id='cssmenu'>
        <ul>
           <li><a href='/ardupilot/index.html'>Home</a>
              <ul>
                 <li><a href='/copter/index.html'>Copter</a></li>
                 <li><a href='/plane/index.html'>Plane</a></li>
                 <li><a href='/rover/index.html'>Rover</a></li>
                 <li><a href='http://ardusub.com/'>Sub</a></li>
                 <li><a href='/antennatracker/index.html'>AntennaTracker</a></li>
                 <li><a href='/planner/index.html'>Mission Planner</a></li>
                 <li><a href='/planner2/index.html'>APM Planner 2</a></li>
                 <li><a href='/mavproxy/index.html'>MAVProxy</a></li>
                 <li><a href='/dev/docs/companion-computers.html'>Companion Computers</a></li>
                 <li><a href='/dev/index.html'>Developer</a></li>
              </ul>
           </li>
           
          
           
           <li><a href='https://firmware.ardupilot.org/'>Downloads</a>
              <ul>
                <li><a href='https://firmware.ardupilot.org/Tools/MissionPlanner/'>Mission Planner</a></li>
                <li><a href='https://firmware.ardupilot.org/Tools/APMPlanner/'>APM Planner 2</a></li>
                   <li><a title="Advanced User Tools" href="common-downloads_advanced_user_tools.html">Advanced User Tools</a></li>
                   <li><a title="Developer Tools" href="common-downloads_developer_tools.html">Developer Tools</a></li>
                   <li><a title="Firmware" href="common-downloads_firmware.html">Firmware</a></li>
                </ul>
           </li>
           
           <li><a href='https://discuss.ardupilot.org' />Community</a>
              <ul>
                 <li><a href='https://discuss.ardupilot.org/'>Support Forums</a></li>
                 <li><a href='https://www.facebook.com/groups/ArduPilot.org'>Facebook</a></li>
                 <li><a href='https://ardupilot.org/discord'>Developer Chat (Discord)</a></li>
                 <li><a href='https://ardupilot.org/discord'>Developer Voice (Discord)</a></li>
				 <li><a href='https://ardupilot.org/dev/docs/common-contact-us.html'>Contact us</a></li>
				 <li><a href='https://ardupilot.org/dev/index.html#getting-involved'>Getting involved</a></li>
                   <li><a title="Commercial Support" href="common-commercial-support.html">Commercial Support</a></li>
                   <li><a title="Dev Team" href="common-team.html">Development Team</a></li>
                   <li><a title="Training Centers" href="common-training-centers.html">UAS Training Centers</a></li>
              </ul>
           </li>
             <li><a title="Stores" href="common-stores.html">Stores</a></li>


             <li><a title="SWAG Shop" href="https://shop.ardupilot.org">SWAG</a></li>

           
           
                        <li><a title="About" href="../index.html">About</a>
               <ul>
                   <li><a title="Project News" href="project-news.html">News</a></li>
                   <li><a title="History of ArduPilot" href="common-history-of-ardupilot.html">History</a></li>
                   <li><a href='https://ardupilot.org/dev/docs/license-gplv3.html'>License</a></li>
                   <li><a href='https://ardupilot.org/dev/docs/trademark.html'>Trademark</a></li>
                   <li><a title="Acknowledgments" href="common-acknowledgments.html">Acknowledgments</a></li>
                   <li><a title="Wiki Editing Guide" href="common-wiki_editing_guide.html">Wiki Editing Guide</a></li>
               </ul>
             </li>
        </ul>
        
<style>
#jdlogo {
  top: 10px;
  right: 20px;
  position: absolute;
  color: #dddddd;
}
#jdlogo a:visited,
#jdlogo a:link {
  color: #9B59B6;
}
#jdlogo a:hover,
#jdlogo a:active {
  color: #CACACA;
}
</style>

</div>

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> Copter
        

        
          
          <img src="../_static/ardupilot_logo.png" class="logo" />
        
        </a>

        
          
          
        

        
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        
        
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introducing Copter</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-autopilots.html">AutoPilot Hardware Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial-setup.html">First Time Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="flying-arducopter.html">First Flight</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-when-problems-arise.html">If A Problem Arises</a></li>
<li class="toctree-l1"><a class="reference internal" href="copter-flight-features.html">Flight Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="common-advanced-configuration.html">Advanced Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="common-rcoutput-mapping.html">Autopilot Output Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="autotune.html">AutoTune</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-auxiliary-functions.html">Auxiliary Function Switches</a></li>
<li class="toctree-l2"><a class="reference internal" href="channel-7-and-8-options.html">Auxiliary Function Switches (3.6 and earlier)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-baro-temp-comp.html">Baro Temperature Compensation</a></li>
<li class="toctree-l2"><a class="reference internal" href="boat-mode.html">Boat mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-bootloader-update.html">Bootloader Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-canbus-setup-advanced.html">CAN Bus Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-compass-setup-advanced.html">Compass Setup (Advanced)</a></li>
<li class="toctree-l2"><a class="reference internal" href="current-limiting-and-voltage-scaling.html">Current Limiting and Voltage Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-dshot.html">Brushless ESCs</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-apm-navigation-extended-kalman-filter-overview.html">Extended Kalman Filter (EKF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-geofencing-landing-page.html">Fence Failsafes</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-flight-time-recorder.html">Flight Time Recorder</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-FPort-receivers.html">FPort Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-gpios.html">GPIOs</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-gps-for-yaw.html">GPS for Yaw (aka Moving Baseline)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-gcs-only-operation.html">Ground Control Station Only Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ground-effect-compensation.html">Ground Effect Compensation</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-imu-fft.html">In-Flight FFT Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-watchdog.html">Independent Watchdog</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">LUA Scripting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-scripts-can-do">What Scripts Can Do</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-sample-script">A Sample Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#script-crashes-and-errors">Script Crashes and Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-documentation">API Documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#location">Location</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vector2f">Vector2f</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vector3f">Vector3f</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ahrs-ahrs">AHRS (ahrs:)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arming-arming">Arming (arming:)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#battery-battery">Battery (battery:)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gps-gps">GPS (gps:)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gcs-gcs">GCS (gcs:)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#serial-led-serialled">Serial LED (serialLED:)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#notify-notify">Notify (notify:)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vehicle-vehicle">Vehicle (vehicle:)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#terrain-terrain">Terrain (terrain:)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#relay-relay">Relay (relay:)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#servo-channels-srv-channels">Servo Channels (SRV_Channels:)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#servo-output">Servo Output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-add-new-bindings">How to Add New Bindings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#further-information">Further Information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="common-lua-binding-syntax.html">Bindings</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="common-magnetic-interference.html">Magnetic Interference</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-MAVLink2-signing.html">MAVLink2 Packet Signing (Security)</a></li>
<li class="toctree-l2"><a class="reference internal" href="motor-thrust-scaling.html">Motor Thrust Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-non-gps-navigation-landing-page.html">Non-GPS Navigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-ntf-devices.html">Notification Devices (LEDs,Buzzer,etc.)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-imu-notch-filtering.html">Notch Filter Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-object-avoidance-landing-page.html">Object Avoidance</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-optical-flow-sensor-setup.html">Optical Flow Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Parameter List (Full)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-parameter-reset.html">Parameter Reset</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-rcmap.html">RC Input Channel Mapping (RCMAP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-rc-options.html">RC Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-camera-runcam.html">RunCam Camera Configuration and Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-sensor-offset-compensation.html">Sensor Position Offset Compensation</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-sensor-testing.html">Sensor Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-serial-passthrough.html">Serial Port to Port Passthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-serial-options.html">Serial Port Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="terrain-following-manual-modes.html">Surface Tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-telemetry-port-setup.html">Telemetry Port Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="terrain-following.html">Terrain Following (Autonomous modes)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-tuning.html">Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-uavcan-setup-advanced.html">UAVCAN Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-ublox-gps.html">UBlox GPS Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">Mission Planning</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-logs.html">Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-optional-hardware.html">Peripheral Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="traditional-helicopters.html">Traditional Helicopters</a></li>
<li class="toctree-l1"><a class="reference internal" href="tricopter.html">Tricopter</a></li>
<li class="toctree-l1"><a class="reference internal" href="singlecopter-and-coaxcopter.html">SingleCopter and CoaxCopter</a></li>
<li class="toctree-l1"><a class="reference internal" href="heliquads.html">HeliQuads</a></li>
<li class="toctree-l1"><a class="reference internal" href="skyrocket.html">SkyRocket</a></li>
<li class="toctree-l1"><a class="reference internal" href="solo_arducopter_upgrade.html">Solo</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference-frames.html">Reference Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-use-cases-and-applications.html">Use-Cases and Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-antenna-tracking.html">Antenna Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-simulation.html">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-master-features.html">Upcoming Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-user-alerts.html">User Alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-appendix.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-table-of-contents.html">Full Table of Contents</a></li>
</ul>

          
        
        
        <!-- add paypal and dronecode logos -->
                <div style="margin: auto; padding-left:20px; padding-right:20px; width=100%">

        <hr />
        <form style="margin:auto;" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
        <input type="hidden" name="cmd" value="_s-xclick" />
        <input type="hidden" name="hosted_button_id" value="BBF28AFAD58B2" />
        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate" />
        </form>
        <br>
        <a href="common-donation.html">Individual</a>
        <a href="common-partners.html">Partners</a>
        <a href="https://shop.ardupilot.org">SWAG Shop</a>

        <hr />
        </div>
        <!-- endadd paypal and dronecode logos -->
              
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Copter</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



 
 
 
 
 
  
   
 

<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="common-advanced-configuration.html">Advanced Configuration</a> &raquo;</li>
      
    <li>Lua Scripts</li>
      <li class="wy-breadcrumbs-aside">
                
          
            <a href="https://github.com/ArduPilot/ardupilot_wiki/blob/master/common/source/docs/common-lua-scripts.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="lua-scripts">
<span id="common-lua-scripts"></span><h1>Lua Scripts<a class="headerlink" href="#lua-scripts" title="Permalink to this headline">¶</a></h1>
<p>ArduPilot has introduced support for <a class="reference external" href="https://www.lua.org/">Lua</a> scripting.
Scripting provides a safe, “sandboxed” environment for new behaviours to be added to the autopilot without modifying the core flight code.
Scripts are stored on the SD card and run in parallel with the flight code.</p>
<p>This page describes how to setup scripts on your autopilot, the scripting API and some examples to help get started.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Lua scripting support was released with Copter-4.0, Rover-4.0 and Plane-3.11.</p>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Ensure your autopilot has at least 2 MB of flash and 70 kB of memory.  High powered autopilots like the Hex Cube Orange and HolyBro Durandal will certainly work well but check the specifications of your <a class="reference internal" href="common-autopilots.html#common-autopilots"><span class="std std-ref">autopilot</span></a>.</p>
</li>
<li><p class="first">Set <a class="reference internal" href="parameters.html#scr-enable"><span class="std std-ref">SCR_ENABLE</span></a> to 1 to enable scripting (refresh or reboot to see all <code class="docutils literal notranslate"><span class="pre">SCR_</span></code> parameters).</p>
</li>
<li><p class="first">Upload scripts (files with extension .lua) to the autopilot’s SD card’s <code class="docutils literal notranslate"><span class="pre">APM/scripts</span></code> folder (if this folder does not exist you can create it by setting <a class="reference internal" href="parameters.html#scr-enable"><span class="std std-ref">SCR_ENABLE</span></a> to 1 and rebooting).  If using Mission Planner, this can be done using MAVFTP.  If using a simulator, the <code class="docutils literal notranslate"><span class="pre">scripts</span></code> folder is in the directory the simulator was started from.</p>
<a class="reference external image-reference" href="../_images/scripting-MP-mavftp.png"><img alt="../_images/scripting-MP-mavftp.png" src="../_images/scripting-MP-mavftp.png" style="width: 450px;" /></a>
</li>
<li><p class="first">Sample scripts can be found <a class="reference external" href="https://github.com/ArduPilot/ardupilot/tree/ArduPlane-stable/libraries/AP_Scripting/examples">here for stable Plane</a>, <a class="reference external" href="https://github.com/ArduPilot/ardupilot/tree/ArduCopter-stable/libraries/AP_Scripting/examples">Copter</a> and <a class="reference external" href="https://github.com/ArduPilot/ardupilot/tree/APMrover2-stable/libraries/AP_Scripting/examples">Rover</a>.  The latest development scripts can be found <a class="reference external" href="https://github.com/ArduPilot/ardupilot/tree/master/libraries/AP_Scripting/examples">here</a>.</p>
</li>
<li><p class="first">When the autopilot is powered on it will load and start all scripts.</p>
</li>
<li><p class="first">Messages and errors are sent to the ground station and, if using Mission Planner, can be viewed in the Data screen’s “Messages” tab.</p>
</li>
<li><p class="first"><a class="reference internal" href="parameters.html#scr-heap-size"><span class="std std-ref">SCR_HEAP_SIZE</span></a> can be adjusted to increase or decrease the amount of memory available for scripts. The default of 43 kB is sufficient for small scripts, and fits onto most autopilots. The autopilot’s free memory depends highly upon which features and peripherals are enabled. If this parameter is set too low, scripts may fail to run. If set too high other autopilot features such as Terrain Following or even the EKF may fail to initialise. On autopilots with a STM32F4 microcontroller Smart RTL and Terrain Following need to be nearly always disabled (they are usally enabled by default, set <a class="reference internal" href="parameters.html#srtl-points"><span class="std std-ref">SRTL_POINTS</span></a> = 0, <a class="reference internal" href="parameters.html#terrain-enable"><span class="std std-ref">TERRAIN_ENABLE</span></a> = 0).</p>
</li>
</ul>
</div>
<div class="section" id="what-scripts-can-do">
<h2>What Scripts Can Do<a class="headerlink" href="#what-scripts-can-do" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Multiple scripts can be run at once</li>
<li>Monitor the vehicle state</li>
<li>Start to manipulate vehicle state</li>
</ul>
<p>Lua is a garbage collected, imperative programming language.
Scripts are run at a low priority on the system, which ensures that the core flight code will continue to execute even if a script is taking a long time to process.
In order to allow multiple scripts to be run, each script is allocated a fixed time chunk (measured in VM instructions) in which it is expected to complete it’s processing.
The script is allowed to specify a new callback function and time at which it should be called, which allows it to be run continuously.
While this serves to bound the worst case execution time safely, scripts are not guaranteed to be run on a reliable schedule.</p>
<p>Each script is run in its own “sandboxed” environment.
This allows each script to manipulate any global variables it wants to without causing other scripts problems, and allows the script to persist state between calls to its callback.
A side effect of this however is that heavy memory usage in a script can cause other scripts to be short on memory.</p>
</div>
<div class="section" id="a-sample-script">
<h2>A Sample Script<a class="headerlink" href="#a-sample-script" title="Permalink to this headline">¶</a></h2>
<p>The following script is used to change a servo output based on the aircraft’s distance from the home position.</p>
<div class="highlight-lua notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">update</span> <span class="p">()</span> <span class="c1">-- periodic function that will be called</span>
  <span class="kd">local</span> <span class="n">current_pos</span> <span class="o">=</span> <span class="n">ahrs</span><span class="p">:</span><span class="n">get_position</span><span class="p">()</span> <span class="c1">-- fetch the current position of the vehicle</span>
  <span class="kd">local</span> <span class="n">home</span> <span class="o">=</span> <span class="n">ahrs</span><span class="p">:</span><span class="n">get_home</span><span class="p">()</span>            <span class="c1">-- fetch the home position of the vehicle</span>
  <span class="kr">if</span> <span class="n">current_pos</span> <span class="ow">and</span> <span class="n">home</span> <span class="kr">then</span>            <span class="c1">-- check that both a vehicle location, and home location are available</span>
    <span class="kd">local</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">current_pos</span><span class="p">:</span><span class="n">get_distance</span><span class="p">(</span><span class="n">home</span><span class="p">)</span> <span class="c1">-- calculate the distance from home in meters</span>
    <span class="kr">if</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="kr">then</span> <span class="c1">-- if more then 1000 meters away</span>
      <span class="n">distance</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>      <span class="c1">-- clamp the distance to 1000 meters</span>
    <span class="kr">end</span>
    <span class="n">servo</span><span class="p">.</span><span class="n">set_output_pwm</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">distance</span><span class="p">)</span> <span class="c1">-- set the servo assigned function 96 (scripting3) to a proportional value</span>
  <span class="kr">end</span>

  <span class="kr">return</span> <span class="n">update</span><span class="p">,</span> <span class="mi">1000</span> <span class="c1">-- request to be rerun again 1000 milliseconds (1 second) from now</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">update</span><span class="p">,</span> <span class="mi">1000</span>   <span class="c1">-- request to be rerun again 1000 milliseconds (1 second) from now</span>
</pre></div>
</td></tr></table></div>
<p>This script begins by defining the update function, which will be called periodically.
This function fetches the vehicles current position and home position, and stores them within the local variables current_pos and home.
Both of these variables now either hold a Location userdata, or are nil, if the information was not currently available from the vehicle.
The variables are then checked to ensure that they were actually provided, before calculating the distance between the locations.
After a check to ensure that the distance is never measured as more then 1 kilometer away, the distance is used to set the servo position.
The final line in the function is used to reschedule this function to be run again in 1000 milliseconds from the current time.
The last line of the script is also used to schedule the function to be run for the first time in 1000 milliseconds from the time at which it’s loaded.</p>
</div>
<div class="section" id="script-crashes-and-errors">
<h2>Script Crashes and Errors<a class="headerlink" href="#script-crashes-and-errors" title="Permalink to this headline">¶</a></h2>
<p>If scripts run out of memory (or panic for any reason) all currently running scripts are terminated, and the scripting engine will restart, and reload all scripts from the disk.
This is allowed to happen at all flight stages, even while the vehicle is armed and flying.</p>
</div>
<div class="section" id="api-documentation">
<h2>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline">¶</a></h2>
<p>The API documentation described here is not a complete list, but rather a work in progress. This list will be expanded upon in the near future. For a full list of the methods currently available, the <a class="reference external" href="https://github.com/ArduPilot/ardupilot/blob/master/libraries/AP_Scripting/generator/description/bindings.desc">binding generator</a> source is the best reference currently available. See <a class="reference internal" href="common-lua-binding-syntax.html#common-lua-binding-syntax"><span class="std std-ref">Binding Description Method Syntax</span></a> for more information on how to decode the methods shown there.</p>
<div class="section" id="location">
<h3>Location<a class="headerlink" href="#location" title="Permalink to this headline">¶</a></h3>
<p>Location is a userdata object that holds locations expressed as latitude, longitude, altitude. The altitude can be in several different frames, relative to home, absolute altitude above mean sea level, or relative to terrain. To create a new Location userdata you can call Location() to allocate an empty location object, or call a method that returns one to you.</p>
<p>A Location userdata object supports the following calls:</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">lat(</span> <span class="pre">[new_lat]</span> <span class="pre">)</span></code> - If called with no arguments, returns the current latitude in degrees * 1e7 as an integer. If called with one argument it will assign the value to the latitude.</li>
<li><code class="code docutils literal notranslate"><span class="pre">lng(</span> <span class="pre">[new_lng]</span> <span class="pre">)</span></code> - If called with no arguments, returns the current longitude in degrees * 1e7 as an integer. If called with one argument it will assign the value to the longitude.</li>
<li><code class="code docutils literal notranslate"><span class="pre">alt(</span> <span class="pre">[new_alt]</span> <span class="pre">)</span></code> - If called with no arguments, returns the current altitude in cm as an integer. If called with one argument it will assign the value to the altitude.</li>
<li><code class="code docutils literal notranslate"><span class="pre">relative_alt(</span> <span class="pre">[is_relative]</span> <span class="pre">)</span></code> - If called with no arguments returns true if the location is planned as relative to home. If called with a boolean value this will set the relative altitude.</li>
<li><code class="code docutils literal notranslate"><span class="pre">terrain_alt(</span> <span class="pre">[is_terrain]</span> <span class="pre">)</span></code> - If called with no arguments returns true if the location is planned as relative to terrain. If called with a boolean value this will flag if the altitude should be relative to terrain.</li>
<li><code class="code docutils literal notranslate"><span class="pre">origin_alt(</span> <span class="pre">[is_origin]</span> <span class="pre">)</span></code> - If called with no arguments returns true if the location is planned in absolute altitude relative to mean sea level. If called with a boolean value this will set the altitude to be relative to mean sea level.</li>
<li><code class="code docutils literal notranslate"><span class="pre">loiter_xtrack(</span> <span class="pre">[should_xtrack]</span> <span class="pre">)</span></code> - If the location is used for a loiter location this flags if the aircraft should track from the center point, or from the exit location of the loiter.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_distance(</span> <span class="pre">other_Location</span> <span class="pre">)</span></code> - Given a Location this calculates the horizontal distance between the two locations in meters.</li>
<li><code class="code docutils literal notranslate"><span class="pre">offset(</span> <span class="pre">offset_north</span> <span class="pre">,</span>&#160; <span class="pre">offset_east</span> <span class="pre">)</span></code> - Translates this Location by the specified number of meters.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_vector_from_origin_NEU()</span></code> - Returns nil or Vector3f that contains the offset from the EKF origin to this location. This will return nil if the EKF origin wasn’t available at the time this was called.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_bearing(</span> <span class="pre">other_Location</span> <span class="pre">)</span></code> - Given a Location this calculates the relative bearing to the location in radians</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_distance_NED(</span> <span class="pre">other_Location</span> <span class="pre">)</span></code> - Returns nil or Vector3f that contains the 3D vector in meters to the other Location.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_distance_NE(</span> <span class="pre">other_Location</span> <span class="pre">)</span></code> - Returns nil or Vector2f that contains the 2D vector in meters to the other Location.</li>
</ul>
</div>
<div class="section" id="vector2f">
<h3>Vector2f<a class="headerlink" href="#vector2f" title="Permalink to this headline">¶</a></h3>
<p>Vector2f is a userdata object that holds a 2D vector. The components are stored as floating point numbers. To create a new Vector2f you can call Vector2f() to allocate a new one, or call a method that returns one to you.</p>
<p>A Vector2f object supports the following calls:</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">x(</span> <span class="pre">[new_x]</span> <span class="pre">)</span></code> - If called with no arguments, return the currently set X component as a floating point number. If called with one argument it will assign the value to the X component.</li>
<li><code class="code docutils literal notranslate"><span class="pre">y(</span> <span class="pre">[new_y]</span> <span class="pre">)</span></code> - If called with no arguments, return the currently set Y component as a floating point number. If called with one argument it will assign the value to the Y component.</li>
<li><code class="code docutils literal notranslate"><span class="pre">length()</span></code> - Returns the length of the vector as a floating point number.</li>
<li><code class="code docutils literal notranslate"><span class="pre">normalize()</span></code> - Normalizes the vector to be a unit vector.</li>
<li><code class="code docutils literal notranslate"><span class="pre">is_nan()</span></code> - Returns true if the vector contains any NaN members.</li>
<li><code class="code docutils literal notranslate"><span class="pre">is_inf()</span></code> - Returns true if the vector contains any infinity members.</li>
<li><code class="code docutils literal notranslate"><span class="pre">is_zero()</span></code> - Returns true if all the vector fields are 0.</li>
</ul>
<p>The following operators are supported on a Vector2f:</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">+</span></code> - Adds the two vectors by components.</li>
<li><code class="code docutils literal notranslate"><span class="pre">-</span></code> - Subtracts the two vectors by components.</li>
</ul>
</div>
<div class="section" id="vector3f">
<h3>Vector3f<a class="headerlink" href="#vector3f" title="Permalink to this headline">¶</a></h3>
<p>Vector3f is a userdata object that holds a 3D vector. The components are stored as floating point numbers. To create a new Vector3f you can call Vector3f() to allocate a new one, or call a method that returns one to you.</p>
<p>A Vector3f object supports the following calls:</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">x(</span> <span class="pre">[new_x]</span> <span class="pre">)</span></code> - If called with no arguments, return the currently set X component as a floating point number. If called with one argument it will assign the value to the X component.</li>
<li><code class="code docutils literal notranslate"><span class="pre">y(</span> <span class="pre">[new_y]</span> <span class="pre">)</span></code> - If called with no arguments, return the currently set Y component as a floating point number. If called with one argument it will assign the value to the Y component.</li>
<li><code class="code docutils literal notranslate"><span class="pre">z(</span> <span class="pre">[new_z]</span> <span class="pre">)</span></code> - If called with no arguments, return the currently set Z component as a floating point number. If called with one argument it will assign the value to the Z component.</li>
<li><code class="code docutils literal notranslate"><span class="pre">length()</span></code> - Returns the length of the vector as a floating point number.</li>
<li><code class="code docutils literal notranslate"><span class="pre">normalize()</span></code> - Normalizes the vector to be a unit vector.</li>
<li><code class="code docutils literal notranslate"><span class="pre">is_nan()</span></code> - Returns true if the vector contains any NaN members.</li>
<li><code class="code docutils literal notranslate"><span class="pre">is_inf()</span></code> - Returns true if the vector contains any infinity members.</li>
<li><code class="code docutils literal notranslate"><span class="pre">is_zero()</span></code> - Returns true if all the vector fields are 0.</li>
</ul>
<p>The following operators are supported on a Vector3f:</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">+</span></code> - Adds the two vectors by components.</li>
<li><code class="code docutils literal notranslate"><span class="pre">-</span></code> - Subtracts the two vectors by components.</li>
</ul>
</div>
<div class="section" id="ahrs-ahrs">
<h3>AHRS (ahrs:)<a class="headerlink" href="#ahrs-ahrs" title="Permalink to this headline">¶</a></h3>
<p>The ahrs library represents the Attitude Heading Reference System computed by the autopilot. It provides estimates for the vehicles attitude, and position.</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">get_roll()</span></code> - Returns the current vehicle roll angle in radians.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_pitch()</span></code> - Returns the current vehicle pitch angle in radians.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_yaw()</span></code> - Returns the current vehicle yaw angle in radians.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_position()</span></code> - Returns nil or Location userdata that contains the vehicles current position. Note: This will only return a Location if the system considers the current estimate to be reasonable.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_home()</span></code> - Returns a Location that contains the vehicles current home waypoint.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_gyro()</span></code> - Returns a Vector3f containing the current smoothed and filtered gyro rates (in radians/second)</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_hagl()</span></code> - Returns nil, or the latest altitude estimate above ground level in meters</li>
<li><code class="code docutils literal notranslate"><span class="pre">wind_estimate()</span></code> - Returns a Vector3f containing the current wind estimate for the vehicle.</li>
<li><code class="code docutils literal notranslate"><span class="pre">groundspeed_vector()</span></code> - Returns a Vector2f containing the vehicles velocity in meters/second in north and east components.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_velocity_NED()</span></code> - Returns nil, or a Vector3f containing the current NED vehicle velocity in meters/second in north, east, and down components.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_velocity_NE()</span></code> - Returns nil, or a Vector2f containing the current NE vehicle velocity in meters/second in north and east components.</li>
<li><code class="code docutils literal notranslate"><span class="pre">home_is_set()</span></code> - Returns a true if home position has been set.</li>
<li><code class="code docutils literal notranslate"><span class="pre">prearm_healthy()</span></code> - Returns a true if current pre-arm checks are passing.</li>
</ul>
</div>
<div class="section" id="arming-arming">
<h3>Arming (arming:)<a class="headerlink" href="#arming-arming" title="Permalink to this headline">¶</a></h3>
<p>The Arming library provides access to arming status and commands.</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">disarm()</span></code> - Disarms the vehicle in all cases. Returns false only if already disarmed.</li>
<li><code class="code docutils literal notranslate"><span class="pre">is_armed()</span></code> -Returns a true if vehicle is currently armed.</li>
<li><code class="code docutils literal notranslate"><span class="pre">arm()</span></code> - Attempts to arm the vehicle. Returns true if successful.</li>
</ul>
</div>
<div class="section" id="battery-battery">
<h3>Battery (battery:)<a class="headerlink" href="#battery-battery" title="Permalink to this headline">¶</a></h3>
<p>The battery library provides access to information about the currently connected batteries on the vehicle.</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">num_instances()</span></code> - Returns the number of battery instances currently available.</li>
<li><code class="code docutils literal notranslate"><span class="pre">healthy(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns true if the requested battery instance is healthy. Healthy is considered to be ArduPilot is currently able to monitor the battery.</li>
<li><code class="code docutils literal notranslate"><span class="pre">voltage(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the voltage of the selected battery instance.</li>
<li><code class="code docutils literal notranslate"><span class="pre">voltage_resting(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the estimated battery voltage if it was not under load.</li>
<li><code class="code docutils literal notranslate"><span class="pre">current_amps(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the current (in Amps) that is currently being consumed by the battery, or nil if current monitoring is not available.</li>
<li><code class="code docutils literal notranslate"><span class="pre">consumed_mah(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the capacity (in milliamp hours) used from the battery, or nil if current monitoring is not available.</li>
<li><code class="code docutils literal notranslate"><span class="pre">consumed_wh(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the used watt hours from the battery, or nil if energy monitoring is not available.</li>
<li><code class="code docutils literal notranslate"><span class="pre">capacity_remaining_pct(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the remaining percentage of battery (from 0 to 100)</li>
<li><code class="code docutils literal notranslate"><span class="pre">pack_capacity_mah(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the full pack capacity (in milliamp hours) from the battery.</li>
<li><code class="code docutils literal notranslate"><span class="pre">has_failsafed()</span></code> - Returns true if any of the batteries being monitored have triggered a failsafe.</li>
<li><code class="code docutils literal notranslate"><span class="pre">overpower_detected(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns true if too much power is being drawn from the battery being monitored.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_temperature(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the temperature of the battery in degrees Celsius if the battery supports temperature monitoring.</li>
</ul>
</div>
<div class="section" id="gps-gps">
<h3>GPS (gps:)<a class="headerlink" href="#gps-gps" title="Permalink to this headline">¶</a></h3>
<p>The GPS library provides access to information about the GPS’s on the vehicle.</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">num_sensors()</span></code> - Returns the number of connected GPS devices. If GPS blending is turned on that will show up as the third sensor, and be reported here.</li>
<li><code class="code docutils literal notranslate"><span class="pre">primary_sensor()</span></code> - Returns which GPS is currently being used as the primary GPS device.</li>
<li><code class="code docutils literal notranslate"><span class="pre">status(instance)</span></code> - Returns the GPS fix status. Compare this to one of the GPS fix types (GPS.NO_GPS, GPS.GPS_OK_FIX_2D, GPS.GPS_OK_FIX_3D GPS.GPS_OK_FIX_3D_DGPS GPS.GPS_OK_FIX_3D_RTK_FLOAT GPS.GPS_OK_FIX_3D_RTK_FIXED</li>
<li><code class="code docutils literal notranslate"><span class="pre">location(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns a Location userdata for the last GPS position. You must check the status to know if the location is still current, if it is NO_GPS, or NO_FIX then it will be returning old data.</li>
<li><code class="code docutils literal notranslate"><span class="pre">speed_accuracy(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns nil, or the speed accuracy of the GPS in meters per second, if the information is available for the GPS instance.</li>
<li><code class="code docutils literal notranslate"><span class="pre">horizontal_accuracy(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns nil, or the horizontal accuracy of the GPS in meters, if the information is available for the GPS instance.</li>
<li><code class="code docutils literal notranslate"><span class="pre">vertical_accuracy(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns nil, or the vertical accuracy of the GPS in meters, if the information is available for the GPS instance.</li>
<li><code class="code docutils literal notranslate"><span class="pre">velocity(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns a Vector3f that contains the velocity as observed by the GPS. You must check the status to know if the velocity is still current.</li>
<li><code class="code docutils literal notranslate"><span class="pre">ground_speed(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the ground speed of the vehicle in meters per second. You must check the status to know if the ground speed is still current.</li>
<li><code class="code docutils literal notranslate"><span class="pre">ground_course(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the ground course of the vehicle in degrees. You must check the status to know if the ground course is still current.</li>
<li><code class="code docutils literal notranslate"><span class="pre">num_sats(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the number of satellites that the GPS is currently tracking.</li>
<li><code class="code docutils literal notranslate"><span class="pre">time_week(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the GPS week number.</li>
<li><code class="code docutils literal notranslate"><span class="pre">time_week_ms(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the number of milliseconds into the current week.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_hdop(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the horizontal dilution of precision of the GPS instance.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_vdop(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the vertical dilution of precision of the GPS instance.</li>
<li><code class="code docutils literal notranslate"><span class="pre">last_fix_time_ms(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns the time of the last fix in system milliseconds.</li>
<li><code class="code docutils literal notranslate"><span class="pre">have_vertical_velocity(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns true if the GPS instance can report the vertical velocity.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_antenna_offset(</span> <span class="pre">instance</span> <span class="pre">)</span></code> - Returns a Vector3f that contains the offsets of the GPS in meters in the body frame.</li>
<li><code class="code docutils literal notranslate"><span class="pre">first_unconfigured_gps()</span></code> - Returns nil or the instance number of the first GPS that has not been fully configured. If all GPS’s have been configured this returns 255 if all the GPS’s have been configured.</li>
</ul>
</div>
<div class="section" id="gcs-gcs">
<h3>GCS (gcs:)<a class="headerlink" href="#gcs-gcs" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">send_text(</span> <span class="pre">severity</span> <span class="pre">,</span>&#160; <span class="pre">text</span> <span class="pre">)</span></code> - Will send the text  string with message severity level . Severity level is :</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="58%" />
<col width="42%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Severity Level</td>
<td>Type</td>
</tr>
<tr class="row-even"><td>0</td>
<td>Emergency</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>Alert</td>
</tr>
<tr class="row-even"><td>2</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>Error</td>
</tr>
<tr class="row-even"><td>4</td>
<td>Warning</td>
</tr>
<tr class="row-odd"><td>5</td>
<td>Notice</td>
</tr>
<tr class="row-even"><td>6</td>
<td>Info</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">set_message_interval(</span> <span class="pre">serial_channel</span> <span class="pre">,</span>&#160; <span class="pre">message_type</span> <span class="pre">,</span>&#160; <span class="pre">rate</span> <span class="pre">)</span></code> - Sets the message_type’s update rate on SERIAL(serial_channel). For example, gcs:set_message_interval(0, 30, 500000) sets SERIAL0 rate for ATTITUDE message stream (30) to 2.0 Hz (500,000 microseconds)</li>
</ul>
</div>
<div class="section" id="serial-led-serialled">
<h3>Serial LED (serialLED:)<a class="headerlink" href="#serial-led-serialled" title="Permalink to this headline">¶</a></h3>
<p>This library allows the control of WS8212B RGB LED strings via an output reserved for scripting and  selected by SERVOx_FUNCTION = 94 thru 109 (Script Out 1 thru 16)</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">set_num_LEDs(</span> <span class="pre">output_number</span> <span class="pre">,</span>&#160; <span class="pre">number_of_LEDs</span> <span class="pre">)</span></code> - Sets the number_of_LEDs in the string on a servo output. output_number is servo output number 1-16 that the string is attached to with a string having &lt;number_of_LEDs&gt;.</li>
<li><code class="code docutils literal notranslate"><span class="pre">set_RGB(</span> <span class="pre">output_number</span> <span class="pre">,</span>&#160; <span class="pre">LED_number</span> <span class="pre">,</span>&#160; <span class="pre">r</span> <span class="pre">,</span> <span class="pre">g</span> <span class="pre">,</span> <span class="pre">b</span> <span class="pre">)</span></code> - Set the data for LED_number (1-32) on the string attached servo output_number (1-16) output to the r,g,b values (0-255)</li>
<li><code class="code docutils literal notranslate"><span class="pre">send()</span></code> - Sends the data to the LED strings</li>
</ul>
</div>
<div class="section" id="notify-notify">
<h3>Notify (notify:)<a class="headerlink" href="#notify-notify" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">play_tune(</span> <span class="pre">tune</span> <span class="pre">)</span></code> - Plays a MML tune through the buzzer on the vehicle. The tune is provided as a string.</li>
</ul>
<p>An online <a class="reference external" href="https://firmware.ardupilot.org/Tools/ToneTester/">tune tester can be found here</a></p>
</div>
<div class="section" id="vehicle-vehicle">
<h3>Vehicle (vehicle:)<a class="headerlink" href="#vehicle-vehicle" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">set_mode(</span> <span class="pre">mode_number</span> <span class="pre">)</span></code> - Attempts to change vehicle (in this example Plane) mode to mode_number. Returns true if successful, false if mode change is not successful.</li>
</ul>
<p>Mode numbers for each vehicle type can be <a class="reference external" href="https://mavlink.io/en/messages/ardupilotmega.html#PLANE_MODE">found here</a></p>
</div>
<div class="section" id="terrain-terrain">
<h3>Terrain (terrain:)<a class="headerlink" href="#terrain-terrain" title="Permalink to this headline">¶</a></h3>
<p>The terrain library proivdes access to checking heights against a terrain database.</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">enabled()</span></code> - Returns true if terrain is enabled.</li>
<li><code class="code docutils literal notranslate"><span class="pre">status()</span></code> - Returns the current status of the rangefinder. Compare this to one of the terrain statuses (terrain.TerrainStatusDisabled, terrain.TerrainStatusUnhealthy, terrain.TerrainStatusOK).</li>
<li><code class="code docutils literal notranslate"><span class="pre">height_amsl(</span> <span class="pre">Location</span> <span class="pre">)</span></code> - Returns the height (in meters) above mean sea level at the provided Location userdata, or returns nil if that is not available.</li>
<li><code class="code docutils literal notranslate"><span class="pre">height_terrain_difference_home(</span> <span class="pre">Location</span> <span class="pre">)</span></code> - Returns the difference in height (in meters) between the provided location and home, or returns nil if that is not available.</li>
<li><code class="code docutils literal notranslate"><span class="pre">height_above_terrain()</span></code> - Returns the height (in meters) that the vehicle is currently above the terrain, or returns nil if that is not available.</li>
</ul>
</div>
<div class="section" id="relay-relay">
<h3>Relay (relay:)<a class="headerlink" href="#relay-relay" title="Permalink to this headline">¶</a></h3>
<p>The relay library proivdes access to controlling relay outputs.</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">on(relay_num)</span></code> - Turns the requested relay on.</li>
<li><code class="code docutils literal notranslate"><span class="pre">off(relay_num)</span></code> - Turns the requested relay off.</li>
<li><code class="code docutils literal notranslate"><span class="pre">enabled(relay_num)</span></code> - Returns true if the requested relay is currently turned on.</li>
<li><code class="code docutils literal notranslate"><span class="pre">toggle(relay_num)</span></code> - Toggles the requested relay on or off.</li>
</ul>
</div>
<div class="section" id="servo-channels-srv-channels">
<h3>Servo Channels (SRV_Channels:)<a class="headerlink" href="#servo-channels-srv-channels" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">find_channel(output_function)</span></code> - Returns first servo output number -1 of an output assigned output_function (See <code class="docutils literal notranslate"><span class="pre">SERVOx_FUNCTION</span></code> parameters ). False if none is assigned.</li>
<li><code class="code docutils literal notranslate"><span class="pre">get_output_pwm(output_function)</span></code> - Returns first servo output PWM value an output assigned output_function (See <code class="docutils literal notranslate"><span class="pre">SERVOx_FUNCTION</span></code> parameters ). False if none is assigned.</li>
<li><code class="code docutils literal notranslate"><span class="pre">set_output_pwm_chan_timeout(channel,</span> <span class="pre">pwm,</span> <span class="pre">timeout)</span></code> - Sets servo channel to specified PWM for a time in ms. This overrides any commands from the autopilot until the timeout expires.</li>
</ul>
</div>
<div class="section" id="servo-output">
<h3>Servo Output<a class="headerlink" href="#servo-output" title="Permalink to this headline">¶</a></h3>
<p>This method stands alone and is called directly as shown below.</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">servo.set_output</span> <span class="pre">(function_number,</span> <span class="pre">PWM)</span></code> -Sets servo outputs of type function_number to a PWM value (typically between 1000 and 2000)</li>
</ul>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>See the <a class="reference external" href="https://github.com/ArduPilot/ardupilot/tree/master/libraries/AP_Scripting/examples">code examples folder</a></p>
</div>
<div class="section" id="how-to-add-new-bindings">
<h2>How to Add New Bindings<a class="headerlink" href="#how-to-add-new-bindings" title="Permalink to this headline">¶</a></h2>
<p>To give Lua scripts access to more features of ArduPilot the API can be extended by creating new bindings. The process is as follows:</p>
<ul class="simple">
<li>Find the method or function you would like to expose to Lua. For example if you wanted to expose an additional feature of AHRS you would first find the method within <a class="reference external" href="https://github.com/ArduPilot/ardupilot/blob/master/libraries/AP_AHRS/AP_AHRS.h">libraries/AP_AHRS/AP_AHRS.h</a>. This can be an already existing method (function) or a method (function) newly added to the code.</li>
<li>Edit the <a class="reference external" href="https://github.com/ArduPilot/ardupilot/blob/master/libraries/AP_Scripting/generator/description/bindings.desc">libraries/AP_Scripting/generator/description/bindings.desc</a> and add a new line in the appropriate section for the method, or add a new section if a new class shall be added by following the examples of the other sections.</li>
<li>Open a command line prompt and cd to the <a class="reference external" href="https://github.com/ArduPilot/ardupilot/tree/master/libraries/AP_Scripting/generator">/libraries/AP_Scripting/generator</a> directory and type “make run”. Alternatively, and probably easier, clean the distribution (./waf distclean) and restart compilation from there as usual.</li>
</ul>
</div>
<div class="section" id="further-information">
<h2>Further Information<a class="headerlink" href="#further-information" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
</div>
<p>For more background on technical decisions made before this point you can reference the presentation from the 2019 ArduPilot Unconference.</p>
<div style="padding-bottom: 56.250000%; padding-top: 30px; position: relative; width: 100%">
<iframe src="https://www.youtube.com/embed/ZUNOZMxOwsI" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div><div style="padding-bottom: 56.250000%; padding-top: 30px; position: relative; width: 100%">
<iframe src="https://www.youtube.com/embed/3n80dYoJQ60" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div></div>
</div>


            
            
             
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="common-lua-binding-syntax.html" class="btn btn-neutral float-right" title="Decoding the LUA Binding Descriptions" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ground-effect-compensation.html" class="btn btn-neutral" title="Ground Effect Compensation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  
  
  Questions, issues, and suggestions about this page can be raised on the <a href="https://discuss.ardupilot.org">forums</a>. Issues and suggestions may be posted on the forums or the <a href="https://github.com/ArduPilot/ardupilot_wiki/issues/new?title=Lua Scripts&amp;body=[Lua Scripts](https://ardupilot.org/copter/docs/common-lua-scripts.html)%20-%20Describe%20the%20issue/suggestion%20and%20improve%20the%20title.%20Please%20keep%20a%20link%20to%20the%20original%20article%20if%20relevant.&amp;labels=docs">Github Issue Tracker</a>.
  <hr/>

  <div role="contentinfo">
    <p>
    <a style="float:right;" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a>
        &copy; Copyright 2020, ArduPilot Dev Team.

    </p>
  </div>
  


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>
      <script type="text/javascript" src="../_static/./useralerts.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
    <script type="text/javascript" src="../_static/js/menubar.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   


<!-- Google Analytics -->
<!-- This is official ArduPilot analytics account -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  _gaq.push(['_trackPageLoadTime']);
  _gaq.push(["_setSiteSpeedSampleRate", 0]);
  ga('create', 'UA-75650032-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- Google Analytics -->

</body>
</html>