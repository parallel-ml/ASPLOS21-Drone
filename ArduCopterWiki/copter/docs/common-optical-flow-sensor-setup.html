

<!-- Path to wiki directories, without backslash -->

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Optical Flow Sensor Testing and Setup &mdash; Copter  documentation</title>
  

  <!-- favicon -->
  
  
    <link rel="shortcut icon" href="../_static/favicon_copter.ico"/>
  
  <!-- favicon end -->
  
  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/common_theme_override.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Copter  documentation" href="../index.html"/>
        <link rel="up" title="Optical Flow Sensors (landingpage)" href="common-optical-flow-sensors-landingpage.html"/>
        <link rel="next" title="Cheerson CX-OF Optical Flow" href="common-cheerson-cxof.html"/>
        <link rel="prev" title="Optical Flow Sensors (landingpage)" href="common-optical-flow-sensors-landingpage.html"/>  
  <script type="text/javascript">
  window.liveSettings = {
    api_key: "53747d3f35bf4cec9372629094cd9fe2",
    picker: "bottom-right",
    detectlang: true,
    autocollect: true,
    dynamic: false
  };
  </script>


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>



<body class="wy-body-for-nav" role="document">

        
    <div id='cssmenu'>
        <ul>
           <li><a href='/ardupilot/index.html'>Home</a>
              <ul>
                 <li><a href='/copter/index.html'>Copter</a></li>
                 <li><a href='/plane/index.html'>Plane</a></li>
                 <li><a href='/rover/index.html'>Rover</a></li>
                 <li><a href='http://ardusub.com/'>Sub</a></li>
                 <li><a href='/antennatracker/index.html'>AntennaTracker</a></li>
                 <li><a href='/planner/index.html'>Mission Planner</a></li>
                 <li><a href='/planner2/index.html'>APM Planner 2</a></li>
                 <li><a href='/mavproxy/index.html'>MAVProxy</a></li>
                 <li><a href='/dev/docs/companion-computers.html'>Companion Computers</a></li>
                 <li><a href='/dev/index.html'>Developer</a></li>
              </ul>
           </li>
           
          
           
           <li><a href='https://firmware.ardupilot.org/'>Downloads</a>
              <ul>
                <li><a href='https://firmware.ardupilot.org/Tools/MissionPlanner/'>Mission Planner</a></li>
                <li><a href='https://firmware.ardupilot.org/Tools/APMPlanner/'>APM Planner 2</a></li>
                   <li><a title="Advanced User Tools" href="common-downloads_advanced_user_tools.html">Advanced User Tools</a></li>
                   <li><a title="Developer Tools" href="common-downloads_developer_tools.html">Developer Tools</a></li>
                   <li><a title="Firmware" href="common-downloads_firmware.html">Firmware</a></li>
                </ul>
           </li>
           
           <li><a href='https://discuss.ardupilot.org' />Community</a>
              <ul>
                 <li><a href='https://discuss.ardupilot.org/'>Support Forums</a></li>
                 <li><a href='https://www.facebook.com/groups/ArduPilot.org'>Facebook</a></li>
                 <li><a href='https://ardupilot.org/discord'>Developer Chat (Discord)</a></li>
                 <li><a href='https://ardupilot.org/discord'>Developer Voice (Discord)</a></li>
				 <li><a href='https://ardupilot.org/dev/docs/common-contact-us.html'>Contact us</a></li>
				 <li><a href='https://ardupilot.org/dev/index.html#getting-involved'>Getting involved</a></li>
                   <li><a title="Commercial Support" href="common-commercial-support.html">Commercial Support</a></li>
                   <li><a title="Dev Team" href="common-team.html">Development Team</a></li>
                   <li><a title="Training Centers" href="common-training-centers.html">UAS Training Centers</a></li>
              </ul>
           </li>
             <li><a title="Stores" href="common-stores.html">Stores</a></li>


             <li><a title="SWAG Shop" href="https://shop.ardupilot.org">SWAG</a></li>

           
           
                        <li><a title="About" href="../index.html">About</a>
               <ul>
                   <li><a title="Project News" href="project-news.html">News</a></li>
                   <li><a title="History of ArduPilot" href="common-history-of-ardupilot.html">History</a></li>
                   <li><a href='https://ardupilot.org/dev/docs/license-gplv3.html'>License</a></li>
                   <li><a href='https://ardupilot.org/dev/docs/trademark.html'>Trademark</a></li>
                   <li><a title="Acknowledgments" href="common-acknowledgments.html">Acknowledgments</a></li>
                   <li><a title="Wiki Editing Guide" href="common-wiki_editing_guide.html">Wiki Editing Guide</a></li>
               </ul>
             </li>
        </ul>
        
<style>
#jdlogo {
  top: 10px;
  right: 20px;
  position: absolute;
  color: #dddddd;
}
#jdlogo a:visited,
#jdlogo a:link {
  color: #9B59B6;
}
#jdlogo a:hover,
#jdlogo a:active {
  color: #CACACA;
}
</style>

</div>

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> Copter
        

        
          
          <img src="../_static/ardupilot_logo.png" class="logo" />
        
        </a>

        
          
          
        

        
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        
        
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introducing Copter</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-autopilots.html">AutoPilot Hardware Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial-setup.html">First Time Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="flying-arducopter.html">First Flight</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-when-problems-arise.html">If A Problem Arises</a></li>
<li class="toctree-l1"><a class="reference internal" href="copter-flight-features.html">Flight Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="common-advanced-configuration.html">Advanced Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="common-rcoutput-mapping.html">Autopilot Output Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="autotune.html">AutoTune</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-auxiliary-functions.html">Auxiliary Function Switches</a></li>
<li class="toctree-l2"><a class="reference internal" href="channel-7-and-8-options.html">Auxiliary Function Switches (3.6 and earlier)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-baro-temp-comp.html">Baro Temperature Compensation</a></li>
<li class="toctree-l2"><a class="reference internal" href="boat-mode.html">Boat mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-bootloader-update.html">Bootloader Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-canbus-setup-advanced.html">CAN Bus Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-compass-setup-advanced.html">Compass Setup (Advanced)</a></li>
<li class="toctree-l2"><a class="reference internal" href="current-limiting-and-voltage-scaling.html">Current Limiting and Voltage Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-dshot.html">Brushless ESCs</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-apm-navigation-extended-kalman-filter-overview.html">Extended Kalman Filter (EKF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-geofencing-landing-page.html">Fence Failsafes</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-flight-time-recorder.html">Flight Time Recorder</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-FPort-receivers.html">FPort Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-gpios.html">GPIOs</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-gps-for-yaw.html">GPS for Yaw (aka Moving Baseline)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-gcs-only-operation.html">Ground Control Station Only Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ground-effect-compensation.html">Ground Effect Compensation</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-imu-fft.html">In-Flight FFT Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-watchdog.html">Independent Watchdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-lua-scripts.html">LUA Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-magnetic-interference.html">Magnetic Interference</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-MAVLink2-signing.html">MAVLink2 Packet Signing (Security)</a></li>
<li class="toctree-l2"><a class="reference internal" href="motor-thrust-scaling.html">Motor Thrust Scaling</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="common-non-gps-navigation-landing-page.html">Non-GPS Navigation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="common-vio-tracking-camera.html">Intel RealSense T265</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-marvelmind.html">MarvelMind Beacons</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="common-optical-flow-sensors-landingpage.html">    Optical Flow</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Optical Flow Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-cheerson-cxof.html">Cheerson CX-OF</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-hereflow.html">HereFlow</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-px4flow-overview.html">PX4FLOW</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-openmv-optflow.html">OpenMV</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="common-optitrack.html">OptiTrack motion capture system</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-pozyx.html">Pozyx Beacons</a></li>
<li class="toctree-l3"><a class="reference external" href="https://ardupilot.org/dev/docs/ros-cartographer-slam.html">ROS with Google Cartographer (Developers only)</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-vicon-for-nongps-navigation.html">Vicon Positioning System</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-zed.html">Visual Odometry with OpenKai and ZED</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-non-gps-to-gps.html">GPS/Non-GPS Transitions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="common-ntf-devices.html">Notification Devices (LEDs,Buzzer,etc.)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-imu-notch-filtering.html">Notch Filter Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-object-avoidance-landing-page.html">Object Avoidance</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Optical Flow Sensor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#testing-the-sensor">Testing the sensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calibrating-the-sensor">Calibrating the sensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#range-sensor-check">Range Sensor Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pre-arm-checks">Pre-Arm checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#first-flight">First Flight</a></li>
<li class="toctree-l3"><a class="reference internal" href="#second-flight">Second Flight</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-video-copter-3-4">Example Video (Copter-3.4)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Parameter List (Full)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-parameter-reset.html">Parameter Reset</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-rcmap.html">RC Input Channel Mapping (RCMAP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-rc-options.html">RC Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-camera-runcam.html">RunCam Camera Configuration and Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-sensor-offset-compensation.html">Sensor Position Offset Compensation</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-sensor-testing.html">Sensor Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-serial-passthrough.html">Serial Port to Port Passthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-serial-options.html">Serial Port Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="terrain-following-manual-modes.html">Surface Tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-telemetry-port-setup.html">Telemetry Port Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="terrain-following.html">Terrain Following (Autonomous modes)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-tuning.html">Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-uavcan-setup-advanced.html">UAVCAN Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-ublox-gps.html">UBlox GPS Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common-mission-planning.html">Mission Planning</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-logs.html">Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-optional-hardware.html">Peripheral Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="traditional-helicopters.html">Traditional Helicopters</a></li>
<li class="toctree-l1"><a class="reference internal" href="tricopter.html">Tricopter</a></li>
<li class="toctree-l1"><a class="reference internal" href="singlecopter-and-coaxcopter.html">SingleCopter and CoaxCopter</a></li>
<li class="toctree-l1"><a class="reference internal" href="heliquads.html">HeliQuads</a></li>
<li class="toctree-l1"><a class="reference internal" href="skyrocket.html">SkyRocket</a></li>
<li class="toctree-l1"><a class="reference internal" href="solo_arducopter_upgrade.html">Solo</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference-frames.html">Reference Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-use-cases-and-applications.html">Use-Cases and Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-antenna-tracking.html">Antenna Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-simulation.html">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-master-features.html">Upcoming Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-user-alerts.html">User Alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-appendix.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-table-of-contents.html">Full Table of Contents</a></li>
</ul>

          
        
        
        <!-- add paypal and dronecode logos -->
                <div style="margin: auto; padding-left:20px; padding-right:20px; width=100%">

        <hr />
        <form style="margin:auto;" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
        <input type="hidden" name="cmd" value="_s-xclick" />
        <input type="hidden" name="hosted_button_id" value="BBF28AFAD58B2" />
        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate" />
        </form>
        <br>
        <a href="common-donation.html">Individual</a>
        <a href="common-partners.html">Partners</a>
        <a href="https://shop.ardupilot.org">SWAG Shop</a>

        <hr />
        </div>
        <!-- endadd paypal and dronecode logos -->
              
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Copter</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



 
 
 
 
 
  
   
 

<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="copter-flight-features.html">Flight Features</a> &raquo;</li>
      
          <li><a href="common-non-gps-navigation-landing-page.html">Non-GPS Navigation</a> &raquo;</li>
      
          <li><a href="common-optical-flow-sensors-landingpage.html">Optical Flow Sensors (landingpage)</a> &raquo;</li>
      
    <li>Optical Flow Sensor Testing and Setup</li>
      <li class="wy-breadcrumbs-aside">
                
          
            <a href="https://github.com/ArduPilot/ardupilot_wiki/blob/master/common/source/docs/common-optical-flow-sensor-setup.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="optical-flow-sensor-testing-and-setup">
<span id="common-optical-flow-sensor-setup"></span><h1>Optical Flow Sensor Testing and Setup<a class="headerlink" href="#optical-flow-sensor-testing-and-setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="testing-the-sensor">
<h2>Testing the sensor<a class="headerlink" href="#testing-the-sensor" title="Permalink to this headline">¶</a></h2>
<p>With the sensor connected to the autopilot, connect to the autopilot with the Mission Planner and open the Flight Data screen’s Status tab.  If the sensor is operating you should see non-zero opt_m_x, opt_m_y and an opt_qua values.</p>
<a class="reference external image-reference" href="../_images/PX4Flow_CheckForData_MP.png"><img alt="../_images/PX4Flow_CheckForData_MP.png" src="../_images/PX4Flow_CheckForData_MP.png" /></a>
</div>
<div class="section" id="calibrating-the-sensor">
<h2>Calibrating the sensor<a class="headerlink" href="#calibrating-the-sensor" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Connect to your autopilot and ensure that logging while disarmed is enabled (In Copter-3.3 set <a class="reference external" href="https://ardupilot.org/copter/docs/parameters.html#log-bitmask" title="(in Copter)"><span class="xref std std-ref">LOG_BITMASK</span></a> to 131071.</p>
</li>
<li><p class="first">Find a location with a textured surface and good lighting (natural light or strong incandescent)</p>
</li>
<li><p class="first">Remove Propellers (safety first)</p>
</li>
<li><p class="first">Power on the vehicle and hold level away from your body and at eye level</p>
</li>
<li><p class="first">Rotate about the vehicle in roll through a range from -15 to +15
degrees in about a second and then back again. Repeat this 5 to 10
times. By closing one eye you will be able to keep the centre of the
sensor stationary against the background while you do the rotation.</p>
</li>
<li><p class="first">Repeat  about the vehicle pitch axis.</p>
</li>
<li><p class="first">Download the data flash logs and plot the <code class="docutils literal notranslate"><span class="pre">OF.flowX</span></code>, <code class="docutils literal notranslate"><span class="pre">OF.bodyX</span></code>
and <code class="docutils literal notranslate"><span class="pre">IMU.GyrX</span></code> data. It should look something like this:</p>
<a class="reference external image-reference" href="../_images/OF-roll-calibration.png"><img alt="../_images/OF-roll-calibration.png" src="../_images/OF-roll-calibration.png" /></a>
</li>
<li><p class="first">If <code class="docutils literal notranslate"><span class="pre">OF.flowX</span></code> is larger or smaller than <code class="docutils literal notranslate"><span class="pre">OF.bodyX</span></code>, then it can
be adjusted by changing the <code class="docutils literal notranslate"><span class="pre">FLOW_FXSCALER</span></code> parameter</p>
</li>
<li><p class="first">IF <code class="docutils literal notranslate"><span class="pre">OF.bodyX</span></code> is uncorrelated or opposite sign to <code class="docutils literal notranslate"><span class="pre">IMU.GyrX</span></code>,
the <a class="reference external" href="https://ardupilot.org/copter/docs/parameters.html#flow-orient-yaw" title="(in Copter)"><span class="xref std std-ref">FLOW_ORIENT_YAW</span></a> parameter is probably set incorrectly or
you do not have the flow sensor pointing downwards</p>
</li>
<li><p class="first">Plot the <code class="docutils literal notranslate"><span class="pre">OF.flowY</span></code>, <code class="docutils literal notranslate"><span class="pre">OF.bodyYband</span></code>, <code class="docutils literal notranslate"><span class="pre">IMU.GyrY</span></code> data. It should
look something like this:</p>
<a class="reference external image-reference" href="../_images/OF-pitch-calibration.png"><img alt="../_images/OF-pitch-calibration.png" src="../_images/OF-pitch-calibration.png" /></a>
</li>
<li><p class="first">If <code class="docutils literal notranslate"><span class="pre">OF.flowY</span></code> is larger or smaller than <code class="docutils literal notranslate"><span class="pre">OF.bodyY</span></code>, then it can
be adjusted by changing the <code class="docutils literal notranslate"><span class="pre">FLOW_FYSCALER</span></code> parameter</p>
</li>
<li><p class="first">IF <code class="docutils literal notranslate"><span class="pre">OF.bodyY</span></code> is uncorrelated or opposite sign to <code class="docutils literal notranslate"><span class="pre">IMU.GyrY</span></code>,
the <a class="reference external" href="https://ardupilot.org/copter/docs/parameters.html#flow-orient-yaw" title="(in Copter)"><span class="xref std std-ref">FLOW_ORIENT_YAW</span></a> parameter is probably set incorrectly or
you do not have the flow sensor pointing downwards</p>
</li>
</ol>
</div>
<div class="section" id="range-sensor-check">
<h2>Range Sensor Check<a class="headerlink" href="#range-sensor-check" title="Permalink to this headline">¶</a></h2>
<p>Check the <code class="docutils literal notranslate"><span class="pre">EKF5.meaRng</span></code> message in the flashlog from your flow
sensor calibration test. Check the following:</p>
<ol class="arabic simple">
<li>There is continuous range measurement.</li>
<li>It outputs a range on the ground that is 10cm of the expected value
(remember that measured range will increase when you roll or pitch
the vehicle because the laser is then measuring on a slant)</li>
</ol>
</div>
<div class="section" id="pre-arm-checks">
<h2>Pre-Arm checks<a class="headerlink" href="#pre-arm-checks" title="Permalink to this headline">¶</a></h2>
<p>To allow arming and taking off in Loiter without a GPS the GPS arming
check should be turned off as shown below.  Unchecking “All” and “GPS”
and leave all other options checked.</p>
<a class="reference external image-reference" href="../_images/OptFlow_ArmingChecks.png"><img alt="../_images/OptFlow_ArmingChecks.png" src="../_images/OptFlow_ArmingChecks.png" /></a>
<p>Because optical flow requires good sonar/range finder data when the
optical flow is enabled, an additional pre-arm check is enforced.</p>
<p><strong>While the vehicle is disarmed you should lift the vehicle straight up
to at least 50cm but no higher than 2m</strong> (if the rangefinder sees a
distance of over 2m you will need to restart the autopilot).</p>
<p>The error message when arming fails this check is “PreArm: check range
finder”</p>
<p>This check can be disabled by unchecking the “Parameter/Sonar” arming
check.</p>
</div>
<div class="section" id="first-flight">
<h2>First Flight<a class="headerlink" href="#first-flight" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Set <a class="reference internal" href="parameters.html#ek2-gps-type"><span class="std std-ref">EK2_GPS_TYPE</span></a> = 0 (we don’t want the optical flow being used by the EKF at this stage)</li>
<li>Perform a short test flight hovering in STABILIZE or AltHold for copter, or QSTABILIZE or QHOVER for QuadPlane, at small lean angles at heights ranging from 50cm to 3m with</li>
<li>Download the flash log and plot the following in mission planner</li>
<li>EKF5.meaRng should correlate with the change in vehicle height</li>
<li><code class="docutils literal notranslate"><span class="pre">OF.flowX</span></code> and <code class="docutils literal notranslate"><span class="pre">OF.flowY</span></code> should be varying</li>
<li><code class="docutils literal notranslate"><span class="pre">OF.bodyX</span></code> and <code class="docutils literal notranslate"><span class="pre">OF.bodyY</span></code> should be consistent with IMU.GyrX and IMU.GyrY</li>
</ol>
</div>
<div class="section" id="second-flight">
<h2>Second Flight<a class="headerlink" href="#second-flight" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You will need at least 15m of clear space around the vehicle to do this flight safely.
If the optical flow velocity estimates are bad, you will have little warning and the copter may lean to its maximum lean angle very quickly.</p>
</div>
<ol class="arabic simple">
<li>Set <a class="reference internal" href="parameters.html#ek2-gps-type"><span class="std std-ref">EK2_GPS_TYPE</span></a> = 3 to make the EKF ignore GPS and use the flow sensor</li>
<li>Ensure you have a loiter and hover mode available on you transmitter.</li>
<li>Set “EKF Origin” on Ground Control Station map. In Mission Planner, right click, select “Set Home here”, and choose to set “set EKF origin here”.</li>
<li>Take-off in loiter and bring the Copter/Quadplane to about 1m height</li>
<li>If the vehicle starts to accelerate away or there is erratic pitch or roll
movement, then switch to hover and land. You will need to
download the log file and share it on <a class="reference external" href="https://discuss.ardupilot.org/c/arducopter">the forums</a> to understand why.</li>
<li>If it holds location then congratulations, you have succeeded and can
now start experimenting with height changes and moving it around in
the loiter mode</li>
</ol>
</div>
<div class="section" id="example-video-copter-3-4">
<h2>Example Video (Copter-3.4)<a class="headerlink" href="#example-video-copter-3-4" title="Permalink to this headline">¶</a></h2>
<div style="padding-bottom: 56.250000%; padding-top: 30px; position: relative; width: 100%">
<iframe src="https://www.youtube.com/embed/Bzgey8iR69Q" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div></div>
</div>


            
            
             
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="common-cheerson-cxof.html" class="btn btn-neutral float-right" title="Cheerson CX-OF Optical Flow" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="common-optical-flow-sensors-landingpage.html" class="btn btn-neutral" title="Optical Flow Sensors (landingpage)" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  
  
  Questions, issues, and suggestions about this page can be raised on the <a href="https://discuss.ardupilot.org">forums</a>. Issues and suggestions may be posted on the forums or the <a href="https://github.com/ArduPilot/ardupilot_wiki/issues/new?title=Optical Flow Sensor Testing and Setup&amp;body=[Optical Flow Sensor Testing and Setup](https://ardupilot.org/copter/docs/common-optical-flow-sensor-setup.html)%20-%20Describe%20the%20issue/suggestion%20and%20improve%20the%20title.%20Please%20keep%20a%20link%20to%20the%20original%20article%20if%20relevant.&amp;labels=docs">Github Issue Tracker</a>.
  <hr/>

  <div role="contentinfo">
    <p>
    <a style="float:right;" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a>
        &copy; Copyright 2020, ArduPilot Dev Team.

    </p>
  </div>
  


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>
      <script type="text/javascript" src="../_static/./useralerts.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
    <script type="text/javascript" src="../_static/js/menubar.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   


<!-- Google Analytics -->
<!-- This is official ArduPilot analytics account -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  _gaq.push(['_trackPageLoadTime']);
  _gaq.push(["_setSiteSpeedSampleRate", 0]);
  ga('create', 'UA-75650032-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- Google Analytics -->

</body>
</html>